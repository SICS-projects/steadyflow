/* IndicatorController.c generated by valac 0.16.1, the Vala compiler
 * generated from IndicatorController.vala, do not modify */

/*
    IndicatorController.vala
    Copyright (C) 2010 Maia Kozheva <sikon@ubuntu.com>

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

#include <glib.h>
#include <glib-object.h>
#include <stdlib.h>
#include <string.h>
#include <gtk/gtk.h>
#include <glib/gi18n-lib.h>
#include <float.h>
#include <math.h>
#include <gee.h>


#define STEADYFLOW_TYPE_INDICATOR_CONTROLLER (steadyflow_indicator_controller_get_type ())
#define STEADYFLOW_INDICATOR_CONTROLLER(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), STEADYFLOW_TYPE_INDICATOR_CONTROLLER, SteadyflowIndicatorController))
#define STEADYFLOW_INDICATOR_CONTROLLER_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), STEADYFLOW_TYPE_INDICATOR_CONTROLLER, SteadyflowIndicatorControllerClass))
#define STEADYFLOW_IS_INDICATOR_CONTROLLER(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), STEADYFLOW_TYPE_INDICATOR_CONTROLLER))
#define STEADYFLOW_IS_INDICATOR_CONTROLLER_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), STEADYFLOW_TYPE_INDICATOR_CONTROLLER))
#define STEADYFLOW_INDICATOR_CONTROLLER_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), STEADYFLOW_TYPE_INDICATOR_CONTROLLER, SteadyflowIndicatorControllerClass))

typedef struct _SteadyflowIndicatorController SteadyflowIndicatorController;
typedef struct _SteadyflowIndicatorControllerClass SteadyflowIndicatorControllerClass;
typedef struct _SteadyflowIndicatorControllerPrivate SteadyflowIndicatorControllerPrivate;
#define _g_timer_destroy0(var) ((var == NULL) ? NULL : (var = (g_timer_destroy (var), NULL)))
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _g_error_free0(var) ((var == NULL) ? NULL : (var = (g_error_free (var), NULL)))

#define STEADYFLOW_UI_TYPE_IINDICATOR_SERVICE (steadyflow_ui_iindicator_service_get_type ())
#define STEADYFLOW_UI_IINDICATOR_SERVICE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), STEADYFLOW_UI_TYPE_IINDICATOR_SERVICE, SteadyflowUIIIndicatorService))
#define STEADYFLOW_UI_IS_IINDICATOR_SERVICE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), STEADYFLOW_UI_TYPE_IINDICATOR_SERVICE))
#define STEADYFLOW_UI_IINDICATOR_SERVICE_GET_INTERFACE(obj) (G_TYPE_INSTANCE_GET_INTERFACE ((obj), STEADYFLOW_UI_TYPE_IINDICATOR_SERVICE, SteadyflowUIIIndicatorServiceIface))

typedef struct _SteadyflowUIIIndicatorService SteadyflowUIIIndicatorService;
typedef struct _SteadyflowUIIIndicatorServiceIface SteadyflowUIIIndicatorServiceIface;

#define STEADYFLOW_CORE_TYPE_ISETTINGS_SERVICE (steadyflow_core_isettings_service_get_type ())
#define STEADYFLOW_CORE_ISETTINGS_SERVICE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), STEADYFLOW_CORE_TYPE_ISETTINGS_SERVICE, SteadyflowCoreISettingsService))
#define STEADYFLOW_CORE_IS_ISETTINGS_SERVICE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), STEADYFLOW_CORE_TYPE_ISETTINGS_SERVICE))
#define STEADYFLOW_CORE_ISETTINGS_SERVICE_GET_INTERFACE(obj) (G_TYPE_INSTANCE_GET_INTERFACE ((obj), STEADYFLOW_CORE_TYPE_ISETTINGS_SERVICE, SteadyflowCoreISettingsServiceIface))

typedef struct _SteadyflowCoreISettingsService SteadyflowCoreISettingsService;
typedef struct _SteadyflowCoreISettingsServiceIface SteadyflowCoreISettingsServiceIface;

#define STEADYFLOW_CORE_TYPE_IDOWNLOAD_SERVICE (steadyflow_core_idownload_service_get_type ())
#define STEADYFLOW_CORE_IDOWNLOAD_SERVICE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), STEADYFLOW_CORE_TYPE_IDOWNLOAD_SERVICE, SteadyflowCoreIDownloadService))
#define STEADYFLOW_CORE_IS_IDOWNLOAD_SERVICE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), STEADYFLOW_CORE_TYPE_IDOWNLOAD_SERVICE))
#define STEADYFLOW_CORE_IDOWNLOAD_SERVICE_GET_INTERFACE(obj) (G_TYPE_INSTANCE_GET_INTERFACE ((obj), STEADYFLOW_CORE_TYPE_IDOWNLOAD_SERVICE, SteadyflowCoreIDownloadServiceIface))

typedef struct _SteadyflowCoreIDownloadService SteadyflowCoreIDownloadService;
typedef struct _SteadyflowCoreIDownloadServiceIface SteadyflowCoreIDownloadServiceIface;

#define STEADYFLOW_CORE_TYPE_IDOWNLOAD_FILE (steadyflow_core_idownload_file_get_type ())
#define STEADYFLOW_CORE_IDOWNLOAD_FILE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), STEADYFLOW_CORE_TYPE_IDOWNLOAD_FILE, SteadyflowCoreIDownloadFile))
#define STEADYFLOW_CORE_IS_IDOWNLOAD_FILE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), STEADYFLOW_CORE_TYPE_IDOWNLOAD_FILE))
#define STEADYFLOW_CORE_IDOWNLOAD_FILE_GET_INTERFACE(obj) (G_TYPE_INSTANCE_GET_INTERFACE ((obj), STEADYFLOW_CORE_TYPE_IDOWNLOAD_FILE, SteadyflowCoreIDownloadFileIface))

typedef struct _SteadyflowCoreIDownloadFile SteadyflowCoreIDownloadFile;
typedef struct _SteadyflowCoreIDownloadFileIface SteadyflowCoreIDownloadFileIface;

#define STEADYFLOW_CORE_IDOWNLOAD_FILE_TYPE_STATUS (steadyflow_core_idownload_file_status_get_type ())

#define STEADYFLOW_CORE_IDOWNLOAD_FILE_TYPE_FINISH_ACTION (steadyflow_core_idownload_file_finish_action_get_type ())
typedef struct _Block5Data Block5Data;
#define _g_free0(var) (var = (g_free (var), NULL))
#define _g_regex_unref0(var) ((var == NULL) ? NULL : (var = (g_regex_unref (var), NULL)))
#define _g_string_free0(var) ((var == NULL) ? NULL : (var = (g_string_free (var, TRUE), NULL)))

struct _SteadyflowIndicatorController {
	GObject parent_instance;
	SteadyflowIndicatorControllerPrivate * priv;
};

struct _SteadyflowIndicatorControllerClass {
	GObjectClass parent_class;
};

struct _SteadyflowIndicatorControllerPrivate {
	GTimer* redraw_timer;
	GtkActionEntry* actions;
	gint actions_length1;
	gint _actions_size_;
	GtkToggleActionEntry* toggle_actions;
	gint toggle_actions_length1;
	gint _toggle_actions_size_;
	GtkUIManager* ui_manager;
	GtkMenu* menu;
	GtkToggleAction* show_hide_action;
	GtkAction* pause_all_action;
	GtkAction* resume_all_action;
	GtkActionGroup* merged_action_group;
	guint merge_id;
};

struct _SteadyflowUIIIndicatorServiceIface {
	GTypeInterface parent_iface;
	void (*set_menu) (SteadyflowUIIIndicatorService* self, GtkMenu* menu);
	gchar* (*get_icon_name) (SteadyflowUIIIndicatorService* self);
	void (*set_icon_name) (SteadyflowUIIIndicatorService* self, const gchar* value);
	gboolean (*get_visible) (SteadyflowUIIIndicatorService* self);
	void (*set_visible) (SteadyflowUIIIndicatorService* self, gboolean value);
};

struct _SteadyflowCoreISettingsServiceIface {
	GTypeInterface parent_iface;
	gboolean (*get_boolean) (SteadyflowCoreISettingsService* self, const gchar* key);
	gint (*get_int) (SteadyflowCoreISettingsService* self, const gchar* key);
	gint (*get_enum) (SteadyflowCoreISettingsService* self, const gchar* key);
	gchar* (*get_string) (SteadyflowCoreISettingsService* self, const gchar* key);
	void (*set_boolean) (SteadyflowCoreISettingsService* self, const gchar* key, gboolean value);
	void (*set_int) (SteadyflowCoreISettingsService* self, const gchar* key, gint value);
	void (*set_enum) (SteadyflowCoreISettingsService* self, const gchar* key, gint value);
	void (*set_string) (SteadyflowCoreISettingsService* self, const gchar* key, const gchar* value);
	void (*save) (SteadyflowCoreISettingsService* self);
};

typedef enum  {
	STEADYFLOW_CORE_IDOWNLOAD_FILE_STATUS_CONNECTING = 0,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_STATUS_DOWNLOADING,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_STATUS_PAUSED,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_STATUS_FINISHED,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_STATUS_NETWORK_ERROR
} SteadyflowCoreIDownloadFileStatus;

typedef enum  {
	STEADYFLOW_CORE_IDOWNLOAD_FILE_FINISH_ACTION_DO_NOTHING = 0,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_FINISH_ACTION_OPEN_FILE,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_FINISH_ACTION_OPEN_FOLDER,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_FINISH_ACTION_RUN_COMMAND
} SteadyflowCoreIDownloadFileFinishAction;

struct _SteadyflowCoreIDownloadFileIface {
	GTypeInterface parent_iface;
	void (*start) (SteadyflowCoreIDownloadFile* self, gboolean resume);
	void (*pause) (SteadyflowCoreIDownloadFile* self);
	void (*serialize) (SteadyflowCoreIDownloadFile* self, GKeyFile* file);
	SteadyflowCoreIDownloadFileStatus (*get_status) (SteadyflowCoreIDownloadFile* self);
	gint (*get_uid) (SteadyflowCoreIDownloadFile* self);
	const gchar* (*get_url) (SteadyflowCoreIDownloadFile* self);
	const gchar* (*get_local_name) (SteadyflowCoreIDownloadFile* self);
	const gchar* (*get_local_basename) (SteadyflowCoreIDownloadFile* self);
	gint64 (*get_size) (SteadyflowCoreIDownloadFile* self);
	gint64 (*get_downloaded_size) (SteadyflowCoreIDownloadFile* self);
	gint (*get_speed) (SteadyflowCoreIDownloadFile* self);
	const gchar* (*get_icon_name) (SteadyflowCoreIDownloadFile* self);
	SteadyflowCoreIDownloadFileFinishAction (*get_finish_action) (SteadyflowCoreIDownloadFile* self);
	const gchar* (*get_finish_command) (SteadyflowCoreIDownloadFile* self);
	GError* (*get_error) (SteadyflowCoreIDownloadFile* self);
};

struct _SteadyflowCoreIDownloadServiceIface {
	GTypeInterface parent_iface;
	SteadyflowCoreIDownloadFile* (*get_file_by_uid) (SteadyflowCoreIDownloadService* self, gint uid);
	SteadyflowCoreIDownloadFile* (*add_file) (SteadyflowCoreIDownloadService* self, const gchar* url, const gchar* local_name, SteadyflowCoreIDownloadFileFinishAction finish_action, const gchar* finish_command, GError** error);
	void (*remove_file) (SteadyflowCoreIDownloadService* self, SteadyflowCoreIDownloadFile* file);
	GeeList* (*get_files) (SteadyflowCoreIDownloadService* self);
};

struct _Block5Data {
	int _ref_count_;
	SteadyflowIndicatorController * self;
	SteadyflowCoreIDownloadFile* file;
};


static gpointer steadyflow_indicator_controller_parent_class = NULL;
static gchar* steadyflow_indicator_controller_stock_quit_label;
static gchar* steadyflow_indicator_controller_stock_quit_label = NULL;

#define STEADYFLOW_INDICATOR_MENU "\n" \
"<ui>\n" \
"\t<popup name=\"IndicatorMenu\">\n" \
"\t\t<menuitem action=\"ShowHide\" />\n" \
"\t\t<menuitem action=\"Add\" />\n" \
"\t\t<separator />\n" \
"\t\t<placeholder name=\"ItemMenus\" />\n" \
"\t\t<separator />\n" \
"\t\t<menuitem action=\"PauseAll\" />\n" \
"\t\t<menuitem action=\"ResumeAll\" />\n" \
"\t\t<separator />\n" \
"\t\t<menuitem action=\"Quit\" />\n" \
"\t</popup>\n" \
"</ui>\n"
#define STEADYFLOW_INSERT_TEMPLATE "\n" \
"<ui>\n" \
"\t<popup name=\"IndicatorMenu\">\n" \
"\t\t<placeholder name=\"ItemMenus\">%s</placeholder>\n" \
"\t</popup>\n" \
"</ui>\n"
GType steadyflow_indicator_controller_get_type (void) G_GNUC_CONST;
#define STEADYFLOW_INDICATOR_CONTROLLER_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), STEADYFLOW_TYPE_INDICATOR_CONTROLLER, SteadyflowIndicatorControllerPrivate))
enum  {
	STEADYFLOW_INDICATOR_CONTROLLER_DUMMY_PROPERTY
};
#define STEADYFLOW_INDICATOR_CONTROLLER_MAX_FILE_MENU_ENTRIES 6
#define STEADYFLOW_INDICATOR_CONTROLLER_REDRAW_SEC 0.2
SteadyflowIndicatorController* steadyflow_indicator_controller_new (void);
SteadyflowIndicatorController* steadyflow_indicator_controller_construct (GType object_type);
void steadyflow_core_util_fatal_error (GError* e, const gchar* message);
GType steadyflow_ui_iindicator_service_get_type (void) G_GNUC_CONST;
SteadyflowUIIIndicatorService* steadyflow_services_get_indicator (void);
void steadyflow_ui_iindicator_service_set_menu (SteadyflowUIIIndicatorService* self, GtkMenu* menu);
GType steadyflow_core_isettings_service_get_type (void) G_GNUC_CONST;
SteadyflowCoreISettingsService* steadyflow_services_get_settings (void);
gboolean steadyflow_core_isettings_service_get_boolean (SteadyflowCoreISettingsService* self, const gchar* key);
void steadyflow_ui_iindicator_service_set_visible (SteadyflowUIIIndicatorService* self, gboolean value);
static void __lambda13_ (SteadyflowIndicatorController* self);
static void ___lambda13__steadyflow_core_isettings_service_changed (SteadyflowCoreISettingsService* _sender, gpointer self);
static void __lambda14_ (SteadyflowIndicatorController* self);
static void ___lambda14__gtk_toggle_action_toggled (GtkToggleAction* _sender, gpointer self);
static void __lambda15_ (SteadyflowIndicatorController* self);
void steadyflow_indicator_controller_set_main_window_visible (SteadyflowIndicatorController* self, gboolean visible);
static void ___lambda15__steadyflow_ui_iindicator_service_clicked (SteadyflowUIIIndicatorService* _sender, gpointer self);
static void __lambda16_ (SteadyflowIndicatorController* self);
static void ___lambda16__gtk_action_activate (GtkAction* _sender, gpointer self);
static void __lambda17_ (SteadyflowIndicatorController* self);
static void ___lambda17__gtk_action_activate (GtkAction* _sender, gpointer self);
static void steadyflow_indicator_controller_pause_all (SteadyflowIndicatorController* self);
static void _steadyflow_indicator_controller_pause_all_gtk_action_activate (GtkAction* _sender, gpointer self);
static void steadyflow_indicator_controller_resume_all (SteadyflowIndicatorController* self);
static void _steadyflow_indicator_controller_resume_all_gtk_action_activate (GtkAction* _sender, gpointer self);
GType steadyflow_core_idownload_file_status_get_type (void) G_GNUC_CONST;
GType steadyflow_core_idownload_file_finish_action_get_type (void) G_GNUC_CONST;
GType steadyflow_core_idownload_file_get_type (void) G_GNUC_CONST;
GType steadyflow_core_idownload_service_get_type (void) G_GNUC_CONST;
SteadyflowCoreIDownloadService* steadyflow_services_get_download (void);
GeeList* steadyflow_core_idownload_service_get_files (SteadyflowCoreIDownloadService* self);
static void steadyflow_indicator_controller_connect_file_signals (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFile* file);
static void __lambda22_ (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFile* file);
static void steadyflow_indicator_controller_update_file_menus (SteadyflowIndicatorController* self, gboolean force);
static void ___lambda22__steadyflow_core_idownload_service_file_added (SteadyflowCoreIDownloadService* _sender, SteadyflowCoreIDownloadFile* file, gpointer self);
static void __lambda23_ (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFile* file);
static void ___lambda23__steadyflow_core_idownload_service_file_removed (SteadyflowCoreIDownloadService* _sender, SteadyflowCoreIDownloadFile* file, gpointer self);
static void __lambda18_ (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFileStatus old_status);
static void ___lambda18__steadyflow_core_idownload_file_status_changed (SteadyflowCoreIDownloadFile* _sender, SteadyflowCoreIDownloadFileStatus old_status, gpointer self);
static void __lambda21_ (SteadyflowIndicatorController* self, gint64 size);
static void ___lambda21__steadyflow_core_idownload_file_download_progressed (SteadyflowCoreIDownloadFile* _sender, gint64 old_size, gpointer self);
gboolean steadyflow_core_idownload_file_can_pause (SteadyflowCoreIDownloadFile* self);
gboolean steadyflow_core_idownload_file_can_start (SteadyflowCoreIDownloadFile* self);
static Block5Data* block5_data_ref (Block5Data* _data5_);
static void block5_data_unref (void * _userdata_);
gint steadyflow_core_idownload_file_get_uid (SteadyflowCoreIDownloadFile* self);
gint64 steadyflow_core_idownload_file_get_downloaded_size (SteadyflowCoreIDownloadFile* self);
gint64 steadyflow_core_idownload_file_get_size (SteadyflowCoreIDownloadFile* self);
const gchar* steadyflow_core_idownload_file_get_local_basename (SteadyflowCoreIDownloadFile* self);
static void ______lambda19_ (Block5Data* _data5_);
void steadyflow_core_idownload_file_start (SteadyflowCoreIDownloadFile* self, gboolean resume);
static void _______lambda19__gtk_action_activate (GtkAction* _sender, gpointer self);
static void ______lambda20_ (Block5Data* _data5_);
void steadyflow_core_idownload_file_pause (SteadyflowCoreIDownloadFile* self);
static void _______lambda20__gtk_action_activate (GtkAction* _sender, gpointer self);
static void steadyflow_indicator_controller_finalize (GObject* obj);


static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


static void __lambda13_ (SteadyflowIndicatorController* self) {
	SteadyflowUIIIndicatorService* _tmp0_;
	SteadyflowUIIIndicatorService* _tmp1_;
	SteadyflowCoreISettingsService* _tmp2_;
	SteadyflowCoreISettingsService* _tmp3_;
	gboolean _tmp4_ = FALSE;
	_tmp0_ = steadyflow_services_get_indicator ();
	_tmp1_ = _tmp0_;
	_tmp2_ = steadyflow_services_get_settings ();
	_tmp3_ = _tmp2_;
	_tmp4_ = steadyflow_core_isettings_service_get_boolean (_tmp3_, "show-indicator");
	steadyflow_ui_iindicator_service_set_visible (_tmp1_, _tmp4_);
}


static void ___lambda13__steadyflow_core_isettings_service_changed (SteadyflowCoreISettingsService* _sender, gpointer self) {
	__lambda13_ (self);
}


static void __lambda14_ (SteadyflowIndicatorController* self) {
	GtkToggleAction* _tmp0_;
	gboolean _tmp1_;
	gboolean _tmp2_;
	_tmp0_ = self->priv->show_hide_action;
	_tmp1_ = gtk_toggle_action_get_active (_tmp0_);
	_tmp2_ = _tmp1_;
	g_signal_emit_by_name (self, "show-hide-toggled", _tmp2_);
}


static void ___lambda14__gtk_toggle_action_toggled (GtkToggleAction* _sender, gpointer self) {
	__lambda14_ (self);
}


static void __lambda15_ (SteadyflowIndicatorController* self) {
	GtkToggleAction* _tmp0_;
	gboolean _tmp1_;
	gboolean _tmp2_;
	_tmp0_ = self->priv->show_hide_action;
	_tmp1_ = gtk_toggle_action_get_active (_tmp0_);
	_tmp2_ = _tmp1_;
	steadyflow_indicator_controller_set_main_window_visible (self, !_tmp2_);
}


static void ___lambda15__steadyflow_ui_iindicator_service_clicked (SteadyflowUIIIndicatorService* _sender, gpointer self) {
	__lambda15_ (self);
}


static void __lambda16_ (SteadyflowIndicatorController* self) {
	g_signal_emit_by_name (self, "add-download-clicked");
}


static void ___lambda16__gtk_action_activate (GtkAction* _sender, gpointer self) {
	__lambda16_ (self);
}


static void __lambda17_ (SteadyflowIndicatorController* self) {
	g_signal_emit_by_name (self, "quit-clicked");
}


static void ___lambda17__gtk_action_activate (GtkAction* _sender, gpointer self) {
	__lambda17_ (self);
}


static void _steadyflow_indicator_controller_pause_all_gtk_action_activate (GtkAction* _sender, gpointer self) {
	steadyflow_indicator_controller_pause_all (self);
}


static void _steadyflow_indicator_controller_resume_all_gtk_action_activate (GtkAction* _sender, gpointer self) {
	steadyflow_indicator_controller_resume_all (self);
}


static void __lambda22_ (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFile* file) {
	SteadyflowCoreIDownloadFile* _tmp0_;
	g_return_if_fail (file != NULL);
	_tmp0_ = file;
	steadyflow_indicator_controller_connect_file_signals (self, _tmp0_);
	steadyflow_indicator_controller_update_file_menus (self, TRUE);
}


static void ___lambda22__steadyflow_core_idownload_service_file_added (SteadyflowCoreIDownloadService* _sender, SteadyflowCoreIDownloadFile* file, gpointer self) {
	__lambda22_ (self, file);
}


static void __lambda23_ (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFile* file) {
	g_return_if_fail (file != NULL);
	steadyflow_indicator_controller_update_file_menus (self, TRUE);
}


static void ___lambda23__steadyflow_core_idownload_service_file_removed (SteadyflowCoreIDownloadService* _sender, SteadyflowCoreIDownloadFile* file, gpointer self) {
	__lambda23_ (self, file);
}


SteadyflowIndicatorController* steadyflow_indicator_controller_construct (GType object_type) {
	SteadyflowIndicatorController * self = NULL;
	GTimer* _tmp0_;
	GTimer* _tmp1_;
	GtkUIManager* _tmp2_;
	GtkActionGroup* _tmp3_;
	GtkActionGroup* action_group;
	GtkActionEntry* _tmp4_;
	gint _tmp4__length1;
	GtkToggleActionEntry* _tmp5_;
	gint _tmp5__length1;
	GtkUIManager* _tmp6_;
	GtkUIManager* _tmp10_;
	GtkWidget* _tmp11_ = NULL;
	GtkMenu* _tmp12_;
	SteadyflowUIIIndicatorService* _tmp13_;
	SteadyflowUIIIndicatorService* _tmp14_;
	GtkMenu* _tmp15_;
	SteadyflowUIIIndicatorService* _tmp16_;
	SteadyflowUIIIndicatorService* _tmp17_;
	SteadyflowCoreISettingsService* _tmp18_;
	SteadyflowCoreISettingsService* _tmp19_;
	gboolean _tmp20_ = FALSE;
	SteadyflowCoreISettingsService* _tmp21_;
	SteadyflowCoreISettingsService* _tmp22_;
	GtkAction* _tmp23_ = NULL;
	GtkToggleAction* _tmp24_;
	GtkToggleAction* _tmp25_;
	SteadyflowCoreISettingsService* _tmp26_;
	SteadyflowCoreISettingsService* _tmp27_;
	gboolean _tmp28_ = FALSE;
	GtkToggleAction* _tmp29_;
	SteadyflowUIIIndicatorService* _tmp30_;
	SteadyflowUIIIndicatorService* _tmp31_;
	GtkAction* _tmp32_ = NULL;
	GtkAction* _tmp33_ = NULL;
	GtkAction* _tmp34_ = NULL;
	GtkAction* _tmp35_;
	GtkAction* _tmp36_;
	GtkAction* _tmp37_;
	GtkAction* _tmp38_ = NULL;
	GtkAction* _tmp39_;
	GtkAction* _tmp40_;
	GtkAction* _tmp41_;
	SteadyflowCoreIDownloadService* _tmp56_;
	SteadyflowCoreIDownloadService* _tmp57_;
	SteadyflowCoreIDownloadService* _tmp58_;
	SteadyflowCoreIDownloadService* _tmp59_;
	GError * _inner_error_ = NULL;
	self = (SteadyflowIndicatorController*) g_object_new (object_type, NULL);
	_tmp0_ = g_timer_new ();
	_g_timer_destroy0 (self->priv->redraw_timer);
	self->priv->redraw_timer = _tmp0_;
	_tmp1_ = self->priv->redraw_timer;
	g_timer_start (_tmp1_);
	_tmp2_ = gtk_ui_manager_new ();
	_g_object_unref0 (self->priv->ui_manager);
	self->priv->ui_manager = _tmp2_;
	_tmp3_ = gtk_action_group_new ("main");
	action_group = _tmp3_;
	_tmp4_ = self->priv->actions;
	_tmp4__length1 = self->priv->actions_length1;
	gtk_action_group_add_actions (action_group, _tmp4_, _tmp4__length1, NULL);
	_tmp5_ = self->priv->toggle_actions;
	_tmp5__length1 = self->priv->toggle_actions_length1;
	gtk_action_group_add_toggle_actions (action_group, _tmp5_, _tmp5__length1, NULL);
	_tmp6_ = self->priv->ui_manager;
	gtk_ui_manager_insert_action_group (_tmp6_, action_group, 0);
	{
		GtkUIManager* _tmp7_;
		gint _tmp8_;
		gint _tmp9_;
		_tmp7_ = self->priv->ui_manager;
		_tmp8_ = strlen (STEADYFLOW_INDICATOR_MENU);
		_tmp9_ = _tmp8_;
		gtk_ui_manager_add_ui_from_string (_tmp7_, STEADYFLOW_INDICATOR_MENU, (gssize) _tmp9_, &_inner_error_);
		if (_inner_error_ != NULL) {
			goto __catch18_g_error;
		}
	}
	goto __finally18;
	__catch18_g_error:
	{
		GError* e = NULL;
		e = _inner_error_;
		_inner_error_ = NULL;
		steadyflow_core_util_fatal_error (e, NULL);
		_g_error_free0 (e);
	}
	__finally18:
	if (_inner_error_ != NULL) {
		_g_object_unref0 (action_group);
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
		g_clear_error (&_inner_error_);
		return NULL;
	}
	_tmp10_ = self->priv->ui_manager;
	_tmp11_ = gtk_ui_manager_get_widget (_tmp10_, "/ui/IndicatorMenu");
	_tmp12_ = _g_object_ref0 (GTK_MENU (_tmp11_));
	_g_object_unref0 (self->priv->menu);
	self->priv->menu = _tmp12_;
	_tmp13_ = steadyflow_services_get_indicator ();
	_tmp14_ = _tmp13_;
	_tmp15_ = self->priv->menu;
	steadyflow_ui_iindicator_service_set_menu (_tmp14_, _tmp15_);
	_tmp16_ = steadyflow_services_get_indicator ();
	_tmp17_ = _tmp16_;
	_tmp18_ = steadyflow_services_get_settings ();
	_tmp19_ = _tmp18_;
	_tmp20_ = steadyflow_core_isettings_service_get_boolean (_tmp19_, "show-indicator");
	steadyflow_ui_iindicator_service_set_visible (_tmp17_, _tmp20_);
	_tmp21_ = steadyflow_services_get_settings ();
	_tmp22_ = _tmp21_;
	g_signal_connect_object (_tmp22_, "changed::show-indicator", (GCallback) ___lambda13__steadyflow_core_isettings_service_changed, self, 0);
	_tmp23_ = gtk_action_group_get_action (action_group, "ShowHide");
	_tmp24_ = _g_object_ref0 (GTK_TOGGLE_ACTION (_tmp23_));
	_g_object_unref0 (self->priv->show_hide_action);
	self->priv->show_hide_action = _tmp24_;
	_tmp25_ = self->priv->show_hide_action;
	_tmp26_ = steadyflow_services_get_settings ();
	_tmp27_ = _tmp26_;
	_tmp28_ = steadyflow_core_isettings_service_get_boolean (_tmp27_, "start-minimized");
	gtk_toggle_action_set_active (_tmp25_, !_tmp28_);
	_tmp29_ = self->priv->show_hide_action;
	g_signal_connect_object (_tmp29_, "toggled", (GCallback) ___lambda14__gtk_toggle_action_toggled, self, 0);
	_tmp30_ = steadyflow_services_get_indicator ();
	_tmp31_ = _tmp30_;
	g_signal_connect_object (_tmp31_, "clicked", (GCallback) ___lambda15__steadyflow_ui_iindicator_service_clicked, self, 0);
	_tmp32_ = gtk_action_group_get_action (action_group, "Add");
	g_signal_connect_object (_tmp32_, "activate", (GCallback) ___lambda16__gtk_action_activate, self, 0);
	_tmp33_ = gtk_action_group_get_action (action_group, "Quit");
	g_signal_connect_object (_tmp33_, "activate", (GCallback) ___lambda17__gtk_action_activate, self, 0);
	_tmp34_ = gtk_action_group_get_action (action_group, "PauseAll");
	_tmp35_ = _g_object_ref0 (GTK_ACTION (_tmp34_));
	_g_object_unref0 (self->priv->pause_all_action);
	self->priv->pause_all_action = _tmp35_;
	_tmp36_ = self->priv->pause_all_action;
	gtk_action_set_sensitive (_tmp36_, FALSE);
	_tmp37_ = self->priv->pause_all_action;
	g_signal_connect_object (_tmp37_, "activate", (GCallback) _steadyflow_indicator_controller_pause_all_gtk_action_activate, self, 0);
	_tmp38_ = gtk_action_group_get_action (action_group, "ResumeAll");
	_tmp39_ = _g_object_ref0 (GTK_ACTION (_tmp38_));
	_g_object_unref0 (self->priv->resume_all_action);
	self->priv->resume_all_action = _tmp39_;
	_tmp40_ = self->priv->resume_all_action;
	gtk_action_set_sensitive (_tmp40_, FALSE);
	_tmp41_ = self->priv->resume_all_action;
	g_signal_connect_object (_tmp41_, "activate", (GCallback) _steadyflow_indicator_controller_resume_all_gtk_action_activate, self, 0);
	{
		SteadyflowCoreIDownloadService* _tmp42_;
		SteadyflowCoreIDownloadService* _tmp43_;
		GeeList* _tmp44_;
		GeeList* _tmp45_;
		GeeList* _file_list;
		GeeList* _tmp46_;
		gint _tmp47_;
		gint _tmp48_;
		gint _file_size;
		gint _file_index;
		_tmp42_ = steadyflow_services_get_download ();
		_tmp43_ = _tmp42_;
		_tmp44_ = steadyflow_core_idownload_service_get_files (_tmp43_);
		_tmp45_ = _tmp44_;
		_file_list = _tmp45_;
		_tmp46_ = _file_list;
		_tmp47_ = gee_collection_get_size ((GeeCollection*) _tmp46_);
		_tmp48_ = _tmp47_;
		_file_size = _tmp48_;
		_file_index = -1;
		while (TRUE) {
			gint _tmp49_;
			gint _tmp50_;
			gint _tmp51_;
			GeeList* _tmp52_;
			gint _tmp53_;
			gpointer _tmp54_ = NULL;
			SteadyflowCoreIDownloadFile* file;
			SteadyflowCoreIDownloadFile* _tmp55_;
			_tmp49_ = _file_index;
			_file_index = _tmp49_ + 1;
			_tmp50_ = _file_index;
			_tmp51_ = _file_size;
			if (!(_tmp50_ < _tmp51_)) {
				break;
			}
			_tmp52_ = _file_list;
			_tmp53_ = _file_index;
			_tmp54_ = gee_list_get (_tmp52_, _tmp53_);
			file = (SteadyflowCoreIDownloadFile*) _tmp54_;
			_tmp55_ = file;
			steadyflow_indicator_controller_connect_file_signals (self, _tmp55_);
			_g_object_unref0 (file);
		}
		_g_object_unref0 (_file_list);
	}
	_tmp56_ = steadyflow_services_get_download ();
	_tmp57_ = _tmp56_;
	g_signal_connect_object (_tmp57_, "file-added", (GCallback) ___lambda22__steadyflow_core_idownload_service_file_added, self, 0);
	_tmp58_ = steadyflow_services_get_download ();
	_tmp59_ = _tmp58_;
	g_signal_connect_object (_tmp59_, "file-removed", (GCallback) ___lambda23__steadyflow_core_idownload_service_file_removed, self, 0);
	steadyflow_indicator_controller_update_file_menus (self, TRUE);
	_g_object_unref0 (action_group);
	return self;
}


SteadyflowIndicatorController* steadyflow_indicator_controller_new (void) {
	return steadyflow_indicator_controller_construct (STEADYFLOW_TYPE_INDICATOR_CONTROLLER);
}


void steadyflow_indicator_controller_set_main_window_visible (SteadyflowIndicatorController* self, gboolean visible) {
	GtkToggleAction* _tmp0_;
	gboolean _tmp1_;
	SteadyflowUIIIndicatorService* _tmp2_;
	SteadyflowUIIIndicatorService* _tmp3_;
	GtkMenu* _tmp4_;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->priv->show_hide_action;
	_tmp1_ = visible;
	gtk_toggle_action_set_active (_tmp0_, _tmp1_);
	_tmp2_ = steadyflow_services_get_indicator ();
	_tmp3_ = _tmp2_;
	_tmp4_ = self->priv->menu;
	steadyflow_ui_iindicator_service_set_menu (_tmp3_, _tmp4_);
}


static void __lambda18_ (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFileStatus old_status) {
	steadyflow_indicator_controller_update_file_menus (self, TRUE);
}


static void ___lambda18__steadyflow_core_idownload_file_status_changed (SteadyflowCoreIDownloadFile* _sender, SteadyflowCoreIDownloadFileStatus old_status, gpointer self) {
	__lambda18_ (self, old_status);
}


static void __lambda21_ (SteadyflowIndicatorController* self, gint64 size) {
	steadyflow_indicator_controller_update_file_menus (self, FALSE);
}


static void ___lambda21__steadyflow_core_idownload_file_download_progressed (SteadyflowCoreIDownloadFile* _sender, gint64 old_size, gpointer self) {
	__lambda21_ (self, old_size);
}


static void steadyflow_indicator_controller_connect_file_signals (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFile* file) {
	SteadyflowCoreIDownloadFile* _tmp0_;
	SteadyflowCoreIDownloadFile* _tmp1_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (file != NULL);
	_tmp0_ = file;
	g_signal_connect_object (_tmp0_, "status-changed", (GCallback) ___lambda18__steadyflow_core_idownload_file_status_changed, self, 0);
	_tmp1_ = file;
	g_signal_connect_object (_tmp1_, "download-progressed", (GCallback) ___lambda21__steadyflow_core_idownload_file_download_progressed, self, 0);
}


static Block5Data* block5_data_ref (Block5Data* _data5_) {
	g_atomic_int_inc (&_data5_->_ref_count_);
	return _data5_;
}


static void block5_data_unref (void * _userdata_) {
	Block5Data* _data5_;
	_data5_ = (Block5Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data5_->_ref_count_)) {
		SteadyflowIndicatorController * self;
		self = _data5_->self;
		_g_object_unref0 (_data5_->file);
		_g_object_unref0 (self);
		g_slice_free (Block5Data, _data5_);
	}
}


static gchar* string_replace (const gchar* self, const gchar* old, const gchar* replacement) {
	gchar* result = NULL;
	GError * _inner_error_ = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (old != NULL, NULL);
	g_return_val_if_fail (replacement != NULL, NULL);
	{
		const gchar* _tmp0_;
		gchar* _tmp1_ = NULL;
		gchar* _tmp2_;
		GRegex* _tmp3_;
		GRegex* _tmp4_;
		GRegex* regex;
		GRegex* _tmp5_;
		const gchar* _tmp6_;
		gchar* _tmp7_ = NULL;
		gchar* _tmp8_;
		_tmp0_ = old;
		_tmp1_ = g_regex_escape_string (_tmp0_, -1);
		_tmp2_ = _tmp1_;
		_tmp3_ = g_regex_new (_tmp2_, 0, 0, &_inner_error_);
		_tmp4_ = _tmp3_;
		_g_free0 (_tmp2_);
		regex = _tmp4_;
		if (_inner_error_ != NULL) {
			if (_inner_error_->domain == G_REGEX_ERROR) {
				goto __catch19_g_regex_error;
			}
			g_critical ("file %s: line %d: unexpected error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
			g_clear_error (&_inner_error_);
			return NULL;
		}
		_tmp5_ = regex;
		_tmp6_ = replacement;
		_tmp7_ = g_regex_replace_literal (_tmp5_, self, (gssize) (-1), 0, _tmp6_, 0, &_inner_error_);
		_tmp8_ = _tmp7_;
		if (_inner_error_ != NULL) {
			_g_regex_unref0 (regex);
			if (_inner_error_->domain == G_REGEX_ERROR) {
				goto __catch19_g_regex_error;
			}
			_g_regex_unref0 (regex);
			g_critical ("file %s: line %d: unexpected error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
			g_clear_error (&_inner_error_);
			return NULL;
		}
		result = _tmp8_;
		_g_regex_unref0 (regex);
		return result;
	}
	goto __finally19;
	__catch19_g_regex_error:
	{
		GError* e = NULL;
		e = _inner_error_;
		_inner_error_ = NULL;
		g_assert_not_reached ();
		_g_error_free0 (e);
	}
	__finally19:
	if (_inner_error_ != NULL) {
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
		g_clear_error (&_inner_error_);
		return NULL;
	}
}


static void ______lambda19_ (Block5Data* _data5_) {
	SteadyflowIndicatorController * self;
	SteadyflowCoreIDownloadFile* _tmp0_;
	self = _data5_->self;
	_tmp0_ = _data5_->file;
	steadyflow_core_idownload_file_start (_tmp0_, TRUE);
}


static void _______lambda19__gtk_action_activate (GtkAction* _sender, gpointer self) {
	______lambda19_ (self);
}


static void ______lambda20_ (Block5Data* _data5_) {
	SteadyflowIndicatorController * self;
	SteadyflowCoreIDownloadFile* _tmp0_;
	self = _data5_->self;
	_tmp0_ = _data5_->file;
	steadyflow_core_idownload_file_pause (_tmp0_);
}


static void _______lambda20__gtk_action_activate (GtkAction* _sender, gpointer self) {
	______lambda20_ (self);
}


static void steadyflow_indicator_controller_update_file_menus (SteadyflowIndicatorController* self, gboolean force) {
	GTimer* _tmp0_;
	gdouble _tmp1_ = 0.0;
	gboolean enable_pause_all;
	gboolean enable_resume_all;
	GeeArrayList* _tmp4_;
	GeeArrayList* files_for_menu;
	GtkAction* _tmp35_;
	gboolean _tmp36_;
	GtkAction* _tmp37_;
	gboolean _tmp38_;
	GtkActionGroup* _tmp39_;
	guint _tmp42_;
	GeeArrayList* _tmp45_;
	gint _tmp46_;
	gint _tmp47_;
	SteadyflowUIIIndicatorService* _tmp123_;
	SteadyflowUIIIndicatorService* _tmp124_;
	GtkMenu* _tmp125_;
	GError * _inner_error_ = NULL;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->priv->redraw_timer;
	_tmp1_ = g_timer_elapsed (_tmp0_, NULL);
	if (_tmp1_ >= STEADYFLOW_INDICATOR_CONTROLLER_REDRAW_SEC) {
		GTimer* _tmp2_;
		_tmp2_ = self->priv->redraw_timer;
		g_timer_start (_tmp2_);
	} else {
		gboolean _tmp3_;
		_tmp3_ = force;
		if (!_tmp3_) {
			return;
		}
	}
	enable_pause_all = FALSE;
	enable_resume_all = FALSE;
	_tmp4_ = gee_array_list_new (STEADYFLOW_CORE_TYPE_IDOWNLOAD_FILE, (GBoxedCopyFunc) g_object_ref, g_object_unref, NULL);
	files_for_menu = _tmp4_;
	{
		SteadyflowCoreIDownloadService* _tmp5_;
		SteadyflowCoreIDownloadService* _tmp6_;
		GeeList* _tmp7_;
		GeeList* _tmp8_;
		GeeList* _file_list;
		GeeList* _tmp9_;
		gint _tmp10_;
		gint _tmp11_;
		gint _file_size;
		gint _file_index;
		_tmp5_ = steadyflow_services_get_download ();
		_tmp6_ = _tmp5_;
		_tmp7_ = steadyflow_core_idownload_service_get_files (_tmp6_);
		_tmp8_ = _tmp7_;
		_file_list = _tmp8_;
		_tmp9_ = _file_list;
		_tmp10_ = gee_collection_get_size ((GeeCollection*) _tmp9_);
		_tmp11_ = _tmp10_;
		_file_size = _tmp11_;
		_file_index = -1;
		while (TRUE) {
			gint _tmp12_;
			gint _tmp13_;
			gint _tmp14_;
			GeeList* _tmp15_;
			gint _tmp16_;
			gpointer _tmp17_ = NULL;
			SteadyflowCoreIDownloadFile* file;
			SteadyflowCoreIDownloadFile* _tmp18_;
			gboolean _tmp19_ = FALSE;
			SteadyflowCoreIDownloadFile* _tmp20_;
			gboolean _tmp21_ = FALSE;
			gboolean _tmp22_ = FALSE;
			GeeArrayList* _tmp23_;
			gint _tmp24_;
			gint _tmp25_;
			gboolean _tmp32_;
			_tmp12_ = _file_index;
			_file_index = _tmp12_ + 1;
			_tmp13_ = _file_index;
			_tmp14_ = _file_size;
			if (!(_tmp13_ < _tmp14_)) {
				break;
			}
			_tmp15_ = _file_list;
			_tmp16_ = _file_index;
			_tmp17_ = gee_list_get (_tmp15_, _tmp16_);
			file = (SteadyflowCoreIDownloadFile*) _tmp17_;
			_tmp18_ = file;
			_tmp19_ = steadyflow_core_idownload_file_can_pause (_tmp18_);
			if (_tmp19_) {
				enable_pause_all = TRUE;
			}
			_tmp20_ = file;
			_tmp21_ = steadyflow_core_idownload_file_can_start (_tmp20_);
			if (_tmp21_) {
				enable_resume_all = TRUE;
			}
			_tmp23_ = files_for_menu;
			_tmp24_ = gee_abstract_collection_get_size ((GeeCollection*) _tmp23_);
			_tmp25_ = _tmp24_;
			if (_tmp25_ < STEADYFLOW_INDICATOR_CONTROLLER_MAX_FILE_MENU_ENTRIES) {
				gboolean _tmp26_ = FALSE;
				SteadyflowCoreIDownloadFile* _tmp27_;
				gboolean _tmp28_ = FALSE;
				gboolean _tmp31_;
				_tmp27_ = file;
				_tmp28_ = steadyflow_core_idownload_file_can_start (_tmp27_);
				if (_tmp28_) {
					_tmp26_ = TRUE;
				} else {
					SteadyflowCoreIDownloadFile* _tmp29_;
					gboolean _tmp30_ = FALSE;
					_tmp29_ = file;
					_tmp30_ = steadyflow_core_idownload_file_can_pause (_tmp29_);
					_tmp26_ = _tmp30_;
				}
				_tmp31_ = _tmp26_;
				_tmp22_ = _tmp31_;
			} else {
				_tmp22_ = FALSE;
			}
			_tmp32_ = _tmp22_;
			if (_tmp32_) {
				GeeArrayList* _tmp33_;
				SteadyflowCoreIDownloadFile* _tmp34_;
				_tmp33_ = files_for_menu;
				_tmp34_ = file;
				gee_abstract_collection_add ((GeeAbstractCollection*) _tmp33_, _tmp34_);
			}
			_g_object_unref0 (file);
		}
		_g_object_unref0 (_file_list);
	}
	_tmp35_ = self->priv->pause_all_action;
	_tmp36_ = enable_pause_all;
	gtk_action_set_sensitive (_tmp35_, _tmp36_);
	_tmp37_ = self->priv->resume_all_action;
	_tmp38_ = enable_resume_all;
	gtk_action_set_sensitive (_tmp37_, _tmp38_);
	_tmp39_ = self->priv->merged_action_group;
	if (_tmp39_ != NULL) {
		GtkUIManager* _tmp40_;
		GtkActionGroup* _tmp41_;
		_tmp40_ = self->priv->ui_manager;
		_tmp41_ = self->priv->merged_action_group;
		gtk_ui_manager_remove_action_group (_tmp40_, _tmp41_);
	}
	_tmp42_ = self->priv->merge_id;
	if (_tmp42_ != ((guint) 0)) {
		GtkUIManager* _tmp43_;
		guint _tmp44_;
		_tmp43_ = self->priv->ui_manager;
		_tmp44_ = self->priv->merge_id;
		gtk_ui_manager_remove_ui (_tmp43_, _tmp44_);
	}
	_tmp45_ = files_for_menu;
	_tmp46_ = gee_abstract_collection_get_size ((GeeCollection*) _tmp45_);
	_tmp47_ = _tmp46_;
	if (_tmp47_ == 0) {
		_g_object_unref0 (self->priv->merged_action_group);
		self->priv->merged_action_group = NULL;
		self->priv->merge_id = (guint) 0;
	} else {
		GtkActionGroup* _tmp48_;
		GString* _tmp49_;
		GString* new_items;
		GString* _tmp110_;
		const gchar* _tmp111_;
		gchar* _tmp112_ = NULL;
		gchar* new_ui;
		GtkUIManager* _tmp120_;
		GtkActionGroup* _tmp121_;
		GtkUIManager* _tmp122_;
		_tmp48_ = gtk_action_group_new ("fileitems");
		_g_object_unref0 (self->priv->merged_action_group);
		self->priv->merged_action_group = _tmp48_;
		_tmp49_ = g_string_new ("");
		new_items = _tmp49_;
		{
			GeeArrayList* _tmp50_;
			GeeArrayList* _tmp51_;
			GeeArrayList* _file_list;
			GeeArrayList* _tmp52_;
			gint _tmp53_;
			gint _tmp54_;
			gint _file_size;
			gint _file_index;
			_tmp50_ = files_for_menu;
			_tmp51_ = _g_object_ref0 (_tmp50_);
			_file_list = _tmp51_;
			_tmp52_ = _file_list;
			_tmp53_ = gee_abstract_collection_get_size ((GeeCollection*) _tmp52_);
			_tmp54_ = _tmp53_;
			_file_size = _tmp54_;
			_file_index = -1;
			while (TRUE) {
				Block5Data* _data5_;
				gint _tmp55_;
				gint _tmp56_;
				gint _tmp57_;
				GeeArrayList* _tmp58_;
				gint _tmp59_;
				gpointer _tmp60_ = NULL;
				SteadyflowCoreIDownloadFile* _tmp61_;
				gint _tmp62_;
				gint _tmp63_;
				gchar* _tmp64_ = NULL;
				gchar* action_name;
				SteadyflowCoreIDownloadFile* _tmp65_;
				gint64 _tmp66_;
				gint64 _tmp67_;
				SteadyflowCoreIDownloadFile* _tmp68_;
				gint64 _tmp69_;
				gint64 _tmp70_;
				gint progress;
				SteadyflowCoreIDownloadFile* _tmp71_;
				const gchar* _tmp72_;
				const gchar* _tmp73_;
				gchar* _tmp74_ = NULL;
				gchar* _tmp75_;
				gchar* _tmp76_;
				gchar* _tmp77_;
				const gchar* _tmp78_ = NULL;
				gint _tmp79_;
				gchar* _tmp80_ = NULL;
				gchar* _tmp81_;
				gchar* _tmp82_;
				gchar* _tmp83_;
				gchar* _tmp84_;
				gchar* _tmp85_;
				gchar* file_label;
				GString* _tmp86_;
				const gchar* _tmp87_;
				gchar* _tmp88_ = NULL;
				gchar* _tmp89_;
				GtkAction* action = NULL;
				SteadyflowCoreIDownloadFile* _tmp90_;
				gboolean _tmp91_ = FALSE;
				GtkActionGroup* _tmp108_;
				GtkAction* _tmp109_;
				_data5_ = g_slice_new0 (Block5Data);
				_data5_->_ref_count_ = 1;
				_data5_->self = g_object_ref (self);
				_tmp55_ = _file_index;
				_file_index = _tmp55_ + 1;
				_tmp56_ = _file_index;
				_tmp57_ = _file_size;
				if (!(_tmp56_ < _tmp57_)) {
					block5_data_unref (_data5_);
					_data5_ = NULL;
					break;
				}
				_tmp58_ = _file_list;
				_tmp59_ = _file_index;
				_tmp60_ = gee_abstract_list_get ((GeeAbstractList*) _tmp58_, _tmp59_);
				_data5_->file = (SteadyflowCoreIDownloadFile*) _tmp60_;
				_tmp61_ = _data5_->file;
				_tmp62_ = steadyflow_core_idownload_file_get_uid (_tmp61_);
				_tmp63_ = _tmp62_;
				_tmp64_ = g_strdup_printf ("FileAction%d", _tmp63_);
				action_name = _tmp64_;
				_tmp65_ = _data5_->file;
				_tmp66_ = steadyflow_core_idownload_file_get_downloaded_size (_tmp65_);
				_tmp67_ = _tmp66_;
				_tmp68_ = _data5_->file;
				_tmp69_ = steadyflow_core_idownload_file_get_size (_tmp68_);
				_tmp70_ = _tmp69_;
				progress = (gint) ((((gdouble) _tmp67_) / _tmp70_) * 100);
				_tmp71_ = _data5_->file;
				_tmp72_ = steadyflow_core_idownload_file_get_local_basename (_tmp71_);
				_tmp73_ = _tmp72_;
				_tmp74_ = string_replace (_tmp73_, "_", "__");
				_tmp75_ = _tmp74_;
				_tmp76_ = g_strconcat (_tmp75_, " ", NULL);
				_tmp77_ = _tmp76_;
				_tmp78_ = _ ("Downloaded %d");
				_tmp79_ = progress;
				_tmp80_ = g_strdup_printf (_tmp78_, _tmp79_);
				_tmp81_ = _tmp80_;
				_tmp82_ = g_strconcat (_tmp77_, _tmp81_, NULL);
				_tmp83_ = _tmp82_;
				_tmp84_ = g_strconcat (_tmp83_, " ", NULL);
				_tmp85_ = _tmp84_;
				_g_free0 (_tmp83_);
				_g_free0 (_tmp81_);
				_g_free0 (_tmp77_);
				_g_free0 (_tmp75_);
				file_label = _tmp85_;
				_tmp86_ = new_items;
				_tmp87_ = action_name;
				_tmp88_ = g_strdup_printf ("<menuitem action='%s' />", _tmp87_);
				_tmp89_ = _tmp88_;
				g_string_append (_tmp86_, _tmp89_);
				_g_free0 (_tmp89_);
				_tmp90_ = _data5_->file;
				_tmp91_ = steadyflow_core_idownload_file_can_start (_tmp90_);
				if (_tmp91_) {
					const gchar* _tmp92_;
					const gchar* _tmp93_ = NULL;
					const gchar* _tmp94_;
					gchar* _tmp95_ = NULL;
					gchar* _tmp96_;
					GtkAction* _tmp97_;
					GtkAction* _tmp98_;
					GtkAction* _tmp99_;
					_tmp92_ = action_name;
					_tmp93_ = _ ("Start %s");
					_tmp94_ = file_label;
					_tmp95_ = g_strdup_printf (_tmp93_, _tmp94_);
					_tmp96_ = _tmp95_;
					_tmp97_ = gtk_action_new (_tmp92_, _tmp96_, NULL, NULL);
					_g_object_unref0 (action);
					action = _tmp97_;
					_g_free0 (_tmp96_);
					_tmp98_ = action;
					gtk_action_set_icon_name (_tmp98_, "media-playback-start");
					_tmp99_ = action;
					g_signal_connect_data (_tmp99_, "activate", (GCallback) _______lambda19__gtk_action_activate, block5_data_ref (_data5_), (GClosureNotify) block5_data_unref, 0);
				} else {
					const gchar* _tmp100_;
					const gchar* _tmp101_ = NULL;
					const gchar* _tmp102_;
					gchar* _tmp103_ = NULL;
					gchar* _tmp104_;
					GtkAction* _tmp105_;
					GtkAction* _tmp106_;
					GtkAction* _tmp107_;
					_tmp100_ = action_name;
					_tmp101_ = _ ("Pause %s");
					_tmp102_ = file_label;
					_tmp103_ = g_strdup_printf (_tmp101_, _tmp102_);
					_tmp104_ = _tmp103_;
					_tmp105_ = gtk_action_new (_tmp100_, _tmp104_, NULL, NULL);
					_g_object_unref0 (action);
					action = _tmp105_;
					_g_free0 (_tmp104_);
					_tmp106_ = action;
					gtk_action_set_icon_name (_tmp106_, "media-playback-pause");
					_tmp107_ = action;
					g_signal_connect_data (_tmp107_, "activate", (GCallback) _______lambda20__gtk_action_activate, block5_data_ref (_data5_), (GClosureNotify) block5_data_unref, 0);
				}
				_tmp108_ = self->priv->merged_action_group;
				_tmp109_ = action;
				gtk_action_group_add_action (_tmp108_, _tmp109_);
				_g_object_unref0 (action);
				_g_free0 (file_label);
				_g_free0 (action_name);
				block5_data_unref (_data5_);
				_data5_ = NULL;
			}
			_g_object_unref0 (_file_list);
		}
		_tmp110_ = new_items;
		_tmp111_ = _tmp110_->str;
		_tmp112_ = g_strdup_printf (STEADYFLOW_INSERT_TEMPLATE, _tmp111_);
		new_ui = _tmp112_;
		{
			GtkUIManager* _tmp113_;
			const gchar* _tmp114_;
			const gchar* _tmp115_;
			gint _tmp116_;
			gint _tmp117_;
			guint _tmp118_ = 0U;
			guint _tmp119_;
			_tmp113_ = self->priv->ui_manager;
			_tmp114_ = new_ui;
			_tmp115_ = new_ui;
			_tmp116_ = strlen (_tmp115_);
			_tmp117_ = _tmp116_;
			_tmp118_ = gtk_ui_manager_add_ui_from_string (_tmp113_, _tmp114_, (gssize) _tmp117_, &_inner_error_);
			_tmp119_ = _tmp118_;
			if (_inner_error_ != NULL) {
				goto __catch20_g_error;
			}
			self->priv->merge_id = _tmp119_;
		}
		goto __finally20;
		__catch20_g_error:
		{
			GError* e = NULL;
			e = _inner_error_;
			_inner_error_ = NULL;
			steadyflow_core_util_fatal_error (e, NULL);
			_g_error_free0 (e);
		}
		__finally20:
		if (_inner_error_ != NULL) {
			_g_free0 (new_ui);
			_g_string_free0 (new_items);
			_g_object_unref0 (files_for_menu);
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
			g_clear_error (&_inner_error_);
			return;
		}
		_tmp120_ = self->priv->ui_manager;
		_tmp121_ = self->priv->merged_action_group;
		gtk_ui_manager_insert_action_group (_tmp120_, _tmp121_, 1);
		_tmp122_ = self->priv->ui_manager;
		gtk_ui_manager_ensure_update (_tmp122_);
		_g_free0 (new_ui);
		_g_string_free0 (new_items);
	}
	_tmp123_ = steadyflow_services_get_indicator ();
	_tmp124_ = _tmp123_;
	_tmp125_ = self->priv->menu;
	steadyflow_ui_iindicator_service_set_menu (_tmp124_, _tmp125_);
	_g_object_unref0 (files_for_menu);
}


static void steadyflow_indicator_controller_pause_all (SteadyflowIndicatorController* self) {
	g_return_if_fail (self != NULL);
	{
		SteadyflowCoreIDownloadService* _tmp0_;
		SteadyflowCoreIDownloadService* _tmp1_;
		GeeList* _tmp2_;
		GeeList* _tmp3_;
		GeeList* _file_list;
		GeeList* _tmp4_;
		gint _tmp5_;
		gint _tmp6_;
		gint _file_size;
		gint _file_index;
		_tmp0_ = steadyflow_services_get_download ();
		_tmp1_ = _tmp0_;
		_tmp2_ = steadyflow_core_idownload_service_get_files (_tmp1_);
		_tmp3_ = _tmp2_;
		_file_list = _tmp3_;
		_tmp4_ = _file_list;
		_tmp5_ = gee_collection_get_size ((GeeCollection*) _tmp4_);
		_tmp6_ = _tmp5_;
		_file_size = _tmp6_;
		_file_index = -1;
		while (TRUE) {
			gint _tmp7_;
			gint _tmp8_;
			gint _tmp9_;
			GeeList* _tmp10_;
			gint _tmp11_;
			gpointer _tmp12_ = NULL;
			SteadyflowCoreIDownloadFile* file;
			SteadyflowCoreIDownloadFile* _tmp13_;
			gboolean _tmp14_ = FALSE;
			_tmp7_ = _file_index;
			_file_index = _tmp7_ + 1;
			_tmp8_ = _file_index;
			_tmp9_ = _file_size;
			if (!(_tmp8_ < _tmp9_)) {
				break;
			}
			_tmp10_ = _file_list;
			_tmp11_ = _file_index;
			_tmp12_ = gee_list_get (_tmp10_, _tmp11_);
			file = (SteadyflowCoreIDownloadFile*) _tmp12_;
			_tmp13_ = file;
			_tmp14_ = steadyflow_core_idownload_file_can_pause (_tmp13_);
			if (_tmp14_) {
				SteadyflowCoreIDownloadFile* _tmp15_;
				_tmp15_ = file;
				steadyflow_core_idownload_file_pause (_tmp15_);
			}
			_g_object_unref0 (file);
		}
		_g_object_unref0 (_file_list);
	}
}


static void steadyflow_indicator_controller_resume_all (SteadyflowIndicatorController* self) {
	g_return_if_fail (self != NULL);
	{
		SteadyflowCoreIDownloadService* _tmp0_;
		SteadyflowCoreIDownloadService* _tmp1_;
		GeeList* _tmp2_;
		GeeList* _tmp3_;
		GeeList* _file_list;
		GeeList* _tmp4_;
		gint _tmp5_;
		gint _tmp6_;
		gint _file_size;
		gint _file_index;
		_tmp0_ = steadyflow_services_get_download ();
		_tmp1_ = _tmp0_;
		_tmp2_ = steadyflow_core_idownload_service_get_files (_tmp1_);
		_tmp3_ = _tmp2_;
		_file_list = _tmp3_;
		_tmp4_ = _file_list;
		_tmp5_ = gee_collection_get_size ((GeeCollection*) _tmp4_);
		_tmp6_ = _tmp5_;
		_file_size = _tmp6_;
		_file_index = -1;
		while (TRUE) {
			gint _tmp7_;
			gint _tmp8_;
			gint _tmp9_;
			GeeList* _tmp10_;
			gint _tmp11_;
			gpointer _tmp12_ = NULL;
			SteadyflowCoreIDownloadFile* file;
			SteadyflowCoreIDownloadFile* _tmp13_;
			gboolean _tmp14_ = FALSE;
			_tmp7_ = _file_index;
			_file_index = _tmp7_ + 1;
			_tmp8_ = _file_index;
			_tmp9_ = _file_size;
			if (!(_tmp8_ < _tmp9_)) {
				break;
			}
			_tmp10_ = _file_list;
			_tmp11_ = _file_index;
			_tmp12_ = gee_list_get (_tmp10_, _tmp11_);
			file = (SteadyflowCoreIDownloadFile*) _tmp12_;
			_tmp13_ = file;
			_tmp14_ = steadyflow_core_idownload_file_can_start (_tmp13_);
			if (_tmp14_) {
				SteadyflowCoreIDownloadFile* _tmp15_;
				_tmp15_ = file;
				steadyflow_core_idownload_file_start (_tmp15_, TRUE);
			}
			_g_object_unref0 (file);
		}
		_g_object_unref0 (_file_list);
	}
}


static void steadyflow_indicator_controller_class_init (SteadyflowIndicatorControllerClass * klass) {
	GtkStockItem item = {0};
	GtkStockItem _tmp0_ = {0};
	GtkStockItem _tmp1_;
	const gchar* _tmp2_;
	gchar* _tmp3_;
	steadyflow_indicator_controller_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (SteadyflowIndicatorControllerPrivate));
	G_OBJECT_CLASS (klass)->finalize = steadyflow_indicator_controller_finalize;
	g_signal_new ("show_hide_toggled", STEADYFLOW_TYPE_INDICATOR_CONTROLLER, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__BOOLEAN, G_TYPE_NONE, 1, G_TYPE_BOOLEAN);
	g_signal_new ("add_download_clicked", STEADYFLOW_TYPE_INDICATOR_CONTROLLER, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
	g_signal_new ("quit_clicked", STEADYFLOW_TYPE_INDICATOR_CONTROLLER, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
	gtk_stock_lookup (GTK_STOCK_QUIT, &_tmp0_);
	item = _tmp0_;
	_tmp1_ = item;
	_tmp2_ = _tmp1_.label;
	_tmp3_ = g_strdup (_tmp2_);
	_g_free0 (steadyflow_indicator_controller_stock_quit_label);
	steadyflow_indicator_controller_stock_quit_label = _tmp3_;
}


static void steadyflow_indicator_controller_instance_init (SteadyflowIndicatorController * self) {
	const gchar* _tmp0_ = NULL;
	GtkActionEntry _tmp1_ = {0};
	const gchar* _tmp2_;
	GtkActionEntry _tmp3_ = {0};
	const gchar* _tmp4_ = NULL;
	GtkActionEntry _tmp5_ = {0};
	const gchar* _tmp6_ = NULL;
	GtkActionEntry _tmp7_ = {0};
	GtkActionEntry* _tmp8_ = NULL;
	const gchar* _tmp9_ = NULL;
	GtkToggleActionEntry _tmp10_ = {0};
	GtkToggleActionEntry* _tmp11_ = NULL;
	self->priv = STEADYFLOW_INDICATOR_CONTROLLER_GET_PRIVATE (self);
	_tmp0_ = _ ("_Add download...");
	memset (&_tmp1_, 0, sizeof (GtkActionEntry));
	_tmp1_.name = "Add";
	_tmp1_.stock_id = "list-add";
	_tmp1_.label = _tmp0_;
	_tmp2_ = steadyflow_indicator_controller_stock_quit_label;
	memset (&_tmp3_, 0, sizeof (GtkActionEntry));
	_tmp3_.name = "Quit";
	_tmp3_.stock_id = "system-shutdown";
	_tmp3_.label = _tmp2_;
	_tmp4_ = _ ("_Pause all");
	memset (&_tmp5_, 0, sizeof (GtkActionEntry));
	_tmp5_.name = "PauseAll";
	_tmp5_.stock_id = "media-playback-pause";
	_tmp5_.label = _tmp4_;
	_tmp6_ = _ ("_Resume all");
	memset (&_tmp7_, 0, sizeof (GtkActionEntry));
	_tmp7_.name = "ResumeAll";
	_tmp7_.stock_id = "media-playback-start";
	_tmp7_.label = _tmp6_;
	_tmp8_ = g_new0 (GtkActionEntry, 4);
	_tmp8_[0] = _tmp1_;
	_tmp8_[1] = _tmp3_;
	_tmp8_[2] = _tmp5_;
	_tmp8_[3] = _tmp7_;
	self->priv->actions = _tmp8_;
	self->priv->actions_length1 = 4;
	self->priv->_actions_size_ = self->priv->actions_length1;
	_tmp9_ = _ ("Show download manager");
	memset (&_tmp10_, 0, sizeof (GtkToggleActionEntry));
	_tmp10_.name = "ShowHide";
	_tmp10_.label = _tmp9_;
	_tmp11_ = g_new0 (GtkToggleActionEntry, 1);
	_tmp11_[0] = _tmp10_;
	self->priv->toggle_actions = _tmp11_;
	self->priv->toggle_actions_length1 = 1;
	self->priv->_toggle_actions_size_ = self->priv->toggle_actions_length1;
	self->priv->merged_action_group = NULL;
	self->priv->merge_id = (guint) 0;
}


static void steadyflow_indicator_controller_finalize (GObject* obj) {
	SteadyflowIndicatorController * self;
	self = STEADYFLOW_INDICATOR_CONTROLLER (obj);
	_g_timer_destroy0 (self->priv->redraw_timer);
	self->priv->actions = (g_free (self->priv->actions), NULL);
	self->priv->toggle_actions = (g_free (self->priv->toggle_actions), NULL);
	_g_object_unref0 (self->priv->ui_manager);
	_g_object_unref0 (self->priv->menu);
	_g_object_unref0 (self->priv->show_hide_action);
	_g_object_unref0 (self->priv->pause_all_action);
	_g_object_unref0 (self->priv->resume_all_action);
	_g_object_unref0 (self->priv->merged_action_group);
	G_OBJECT_CLASS (steadyflow_indicator_controller_parent_class)->finalize (obj);
}


GType steadyflow_indicator_controller_get_type (void) {
	static volatile gsize steadyflow_indicator_controller_type_id__volatile = 0;
	if (g_once_init_enter (&steadyflow_indicator_controller_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (SteadyflowIndicatorControllerClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) steadyflow_indicator_controller_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (SteadyflowIndicatorController), 0, (GInstanceInitFunc) steadyflow_indicator_controller_instance_init, NULL };
		GType steadyflow_indicator_controller_type_id;
		steadyflow_indicator_controller_type_id = g_type_register_static (G_TYPE_OBJECT, "SteadyflowIndicatorController", &g_define_type_info, 0);
		g_once_init_leave (&steadyflow_indicator_controller_type_id__volatile, steadyflow_indicator_controller_type_id);
	}
	return steadyflow_indicator_controller_type_id__volatile;
}



