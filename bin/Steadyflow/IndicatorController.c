/* IndicatorController.c generated by valac 0.16.1, the Vala compiler
 * generated from IndicatorController.vala, do not modify */

/*
    IndicatorController.vala
    Copyright (C) 2010 Maia Kozheva <sikon@ubuntu.com>

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

#include <glib.h>
#include <glib-object.h>
#include <stdlib.h>
#include <string.h>
#include <gtk/gtk.h>
#include <glib/gi18n-lib.h>
#include <gee.h>


#define STEADYFLOW_TYPE_INDICATOR_CONTROLLER (steadyflow_indicator_controller_get_type ())
#define STEADYFLOW_INDICATOR_CONTROLLER(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), STEADYFLOW_TYPE_INDICATOR_CONTROLLER, SteadyflowIndicatorController))
#define STEADYFLOW_INDICATOR_CONTROLLER_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), STEADYFLOW_TYPE_INDICATOR_CONTROLLER, SteadyflowIndicatorControllerClass))
#define STEADYFLOW_IS_INDICATOR_CONTROLLER(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), STEADYFLOW_TYPE_INDICATOR_CONTROLLER))
#define STEADYFLOW_IS_INDICATOR_CONTROLLER_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), STEADYFLOW_TYPE_INDICATOR_CONTROLLER))
#define STEADYFLOW_INDICATOR_CONTROLLER_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), STEADYFLOW_TYPE_INDICATOR_CONTROLLER, SteadyflowIndicatorControllerClass))

typedef struct _SteadyflowIndicatorController SteadyflowIndicatorController;
typedef struct _SteadyflowIndicatorControllerClass SteadyflowIndicatorControllerClass;
typedef struct _SteadyflowIndicatorControllerPrivate SteadyflowIndicatorControllerPrivate;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _g_error_free0(var) ((var == NULL) ? NULL : (var = (g_error_free (var), NULL)))

#define STEADYFLOW_UI_TYPE_IINDICATOR_SERVICE (steadyflow_ui_iindicator_service_get_type ())
#define STEADYFLOW_UI_IINDICATOR_SERVICE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), STEADYFLOW_UI_TYPE_IINDICATOR_SERVICE, SteadyflowUIIIndicatorService))
#define STEADYFLOW_UI_IS_IINDICATOR_SERVICE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), STEADYFLOW_UI_TYPE_IINDICATOR_SERVICE))
#define STEADYFLOW_UI_IINDICATOR_SERVICE_GET_INTERFACE(obj) (G_TYPE_INSTANCE_GET_INTERFACE ((obj), STEADYFLOW_UI_TYPE_IINDICATOR_SERVICE, SteadyflowUIIIndicatorServiceIface))

typedef struct _SteadyflowUIIIndicatorService SteadyflowUIIIndicatorService;
typedef struct _SteadyflowUIIIndicatorServiceIface SteadyflowUIIIndicatorServiceIface;

#define STEADYFLOW_CORE_TYPE_ISETTINGS_SERVICE (steadyflow_core_isettings_service_get_type ())
#define STEADYFLOW_CORE_ISETTINGS_SERVICE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), STEADYFLOW_CORE_TYPE_ISETTINGS_SERVICE, SteadyflowCoreISettingsService))
#define STEADYFLOW_CORE_IS_ISETTINGS_SERVICE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), STEADYFLOW_CORE_TYPE_ISETTINGS_SERVICE))
#define STEADYFLOW_CORE_ISETTINGS_SERVICE_GET_INTERFACE(obj) (G_TYPE_INSTANCE_GET_INTERFACE ((obj), STEADYFLOW_CORE_TYPE_ISETTINGS_SERVICE, SteadyflowCoreISettingsServiceIface))

typedef struct _SteadyflowCoreISettingsService SteadyflowCoreISettingsService;
typedef struct _SteadyflowCoreISettingsServiceIface SteadyflowCoreISettingsServiceIface;

#define STEADYFLOW_CORE_TYPE_IDOWNLOAD_SERVICE (steadyflow_core_idownload_service_get_type ())
#define STEADYFLOW_CORE_IDOWNLOAD_SERVICE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), STEADYFLOW_CORE_TYPE_IDOWNLOAD_SERVICE, SteadyflowCoreIDownloadService))
#define STEADYFLOW_CORE_IS_IDOWNLOAD_SERVICE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), STEADYFLOW_CORE_TYPE_IDOWNLOAD_SERVICE))
#define STEADYFLOW_CORE_IDOWNLOAD_SERVICE_GET_INTERFACE(obj) (G_TYPE_INSTANCE_GET_INTERFACE ((obj), STEADYFLOW_CORE_TYPE_IDOWNLOAD_SERVICE, SteadyflowCoreIDownloadServiceIface))

typedef struct _SteadyflowCoreIDownloadService SteadyflowCoreIDownloadService;
typedef struct _SteadyflowCoreIDownloadServiceIface SteadyflowCoreIDownloadServiceIface;

#define STEADYFLOW_CORE_TYPE_IDOWNLOAD_FILE (steadyflow_core_idownload_file_get_type ())
#define STEADYFLOW_CORE_IDOWNLOAD_FILE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), STEADYFLOW_CORE_TYPE_IDOWNLOAD_FILE, SteadyflowCoreIDownloadFile))
#define STEADYFLOW_CORE_IS_IDOWNLOAD_FILE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), STEADYFLOW_CORE_TYPE_IDOWNLOAD_FILE))
#define STEADYFLOW_CORE_IDOWNLOAD_FILE_GET_INTERFACE(obj) (G_TYPE_INSTANCE_GET_INTERFACE ((obj), STEADYFLOW_CORE_TYPE_IDOWNLOAD_FILE, SteadyflowCoreIDownloadFileIface))

typedef struct _SteadyflowCoreIDownloadFile SteadyflowCoreIDownloadFile;
typedef struct _SteadyflowCoreIDownloadFileIface SteadyflowCoreIDownloadFileIface;

#define STEADYFLOW_CORE_IDOWNLOAD_FILE_TYPE_STATUS (steadyflow_core_idownload_file_status_get_type ())

#define STEADYFLOW_CORE_IDOWNLOAD_FILE_TYPE_FINISH_ACTION (steadyflow_core_idownload_file_finish_action_get_type ())
typedef struct _Block5Data Block5Data;
#define _g_free0(var) (var = (g_free (var), NULL))
#define _g_regex_unref0(var) ((var == NULL) ? NULL : (var = (g_regex_unref (var), NULL)))
#define _g_string_free0(var) ((var == NULL) ? NULL : (var = (g_string_free (var, TRUE), NULL)))

struct _SteadyflowIndicatorController {
	GObject parent_instance;
	SteadyflowIndicatorControllerPrivate * priv;
};

struct _SteadyflowIndicatorControllerClass {
	GObjectClass parent_class;
};

struct _SteadyflowIndicatorControllerPrivate {
	GtkActionEntry* actions;
	gint actions_length1;
	gint _actions_size_;
	GtkToggleActionEntry* toggle_actions;
	gint toggle_actions_length1;
	gint _toggle_actions_size_;
	GtkUIManager* ui_manager;
	GtkMenu* menu;
	GtkToggleAction* show_hide_action;
	GtkAction* pause_all_action;
	GtkAction* resume_all_action;
	GtkActionGroup* merged_action_group;
	guint merge_id;
};

struct _SteadyflowUIIIndicatorServiceIface {
	GTypeInterface parent_iface;
	void (*set_menu) (SteadyflowUIIIndicatorService* self, GtkMenu* menu);
	gchar* (*get_icon_name) (SteadyflowUIIIndicatorService* self);
	void (*set_icon_name) (SteadyflowUIIIndicatorService* self, const gchar* value);
	gboolean (*get_visible) (SteadyflowUIIIndicatorService* self);
	void (*set_visible) (SteadyflowUIIIndicatorService* self, gboolean value);
};

struct _SteadyflowCoreISettingsServiceIface {
	GTypeInterface parent_iface;
	gboolean (*get_boolean) (SteadyflowCoreISettingsService* self, const gchar* key);
	gint (*get_int) (SteadyflowCoreISettingsService* self, const gchar* key);
	gint (*get_enum) (SteadyflowCoreISettingsService* self, const gchar* key);
	gchar* (*get_string) (SteadyflowCoreISettingsService* self, const gchar* key);
	void (*set_boolean) (SteadyflowCoreISettingsService* self, const gchar* key, gboolean value);
	void (*set_int) (SteadyflowCoreISettingsService* self, const gchar* key, gint value);
	void (*set_enum) (SteadyflowCoreISettingsService* self, const gchar* key, gint value);
	void (*set_string) (SteadyflowCoreISettingsService* self, const gchar* key, const gchar* value);
	void (*save) (SteadyflowCoreISettingsService* self);
};

typedef enum  {
	STEADYFLOW_CORE_IDOWNLOAD_FILE_STATUS_CONNECTING = 0,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_STATUS_DOWNLOADING,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_STATUS_PAUSED,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_STATUS_FINISHED,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_STATUS_NETWORK_ERROR
} SteadyflowCoreIDownloadFileStatus;

typedef enum  {
	STEADYFLOW_CORE_IDOWNLOAD_FILE_FINISH_ACTION_DO_NOTHING = 0,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_FINISH_ACTION_OPEN_FILE,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_FINISH_ACTION_OPEN_FOLDER,
	STEADYFLOW_CORE_IDOWNLOAD_FILE_FINISH_ACTION_RUN_COMMAND
} SteadyflowCoreIDownloadFileFinishAction;

struct _SteadyflowCoreIDownloadFileIface {
	GTypeInterface parent_iface;
	void (*start) (SteadyflowCoreIDownloadFile* self, gboolean resume);
	void (*pause) (SteadyflowCoreIDownloadFile* self);
	void (*serialize) (SteadyflowCoreIDownloadFile* self, GKeyFile* file);
	SteadyflowCoreIDownloadFileStatus (*get_status) (SteadyflowCoreIDownloadFile* self);
	gint (*get_uid) (SteadyflowCoreIDownloadFile* self);
	const gchar* (*get_url) (SteadyflowCoreIDownloadFile* self);
	const gchar* (*get_local_name) (SteadyflowCoreIDownloadFile* self);
	const gchar* (*get_local_basename) (SteadyflowCoreIDownloadFile* self);
	gint64 (*get_size) (SteadyflowCoreIDownloadFile* self);
	gint64 (*get_downloaded_size) (SteadyflowCoreIDownloadFile* self);
	gint (*get_speed) (SteadyflowCoreIDownloadFile* self);
	const gchar* (*get_icon_name) (SteadyflowCoreIDownloadFile* self);
	SteadyflowCoreIDownloadFileFinishAction (*get_finish_action) (SteadyflowCoreIDownloadFile* self);
	const gchar* (*get_finish_command) (SteadyflowCoreIDownloadFile* self);
	GError* (*get_error) (SteadyflowCoreIDownloadFile* self);
};

struct _SteadyflowCoreIDownloadServiceIface {
	GTypeInterface parent_iface;
	SteadyflowCoreIDownloadFile* (*get_file_by_uid) (SteadyflowCoreIDownloadService* self, gint uid);
	SteadyflowCoreIDownloadFile* (*add_file) (SteadyflowCoreIDownloadService* self, const gchar* url, const gchar* local_name, SteadyflowCoreIDownloadFileFinishAction finish_action, const gchar* finish_command, GError** error);
	void (*remove_file) (SteadyflowCoreIDownloadService* self, SteadyflowCoreIDownloadFile* file);
	GeeList* (*get_files) (SteadyflowCoreIDownloadService* self);
};

struct _Block5Data {
	int _ref_count_;
	SteadyflowIndicatorController * self;
	SteadyflowCoreIDownloadFile* file;
};


static gpointer steadyflow_indicator_controller_parent_class = NULL;
static gchar* steadyflow_indicator_controller_stock_quit_label;
static gchar* steadyflow_indicator_controller_stock_quit_label = NULL;

#define STEADYFLOW_INDICATOR_MENU "\n" \
"<ui>\n" \
"\t<popup name=\"IndicatorMenu\">\n" \
"\t\t<menuitem action=\"ShowHide\" />\n" \
"\t\t<menuitem action=\"Add\" />\n" \
"\t\t<separator />\n" \
"\t\t<placeholder name=\"ItemMenus\" />\n" \
"\t\t<separator />\n" \
"\t\t<menuitem action=\"PauseAll\" />\n" \
"\t\t<menuitem action=\"ResumeAll\" />\n" \
"\t\t<separator />\n" \
"\t\t<menuitem action=\"Quit\" />\n" \
"\t</popup>\n" \
"</ui>\n"
#define STEADYFLOW_INSERT_TEMPLATE "\n" \
"<ui>\n" \
"\t<popup name=\"IndicatorMenu\">\n" \
"\t\t<placeholder name=\"ItemMenus\">%s</placeholder>\n" \
"\t</popup>\n" \
"</ui>\n"
GType steadyflow_indicator_controller_get_type (void) G_GNUC_CONST;
#define STEADYFLOW_INDICATOR_CONTROLLER_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), STEADYFLOW_TYPE_INDICATOR_CONTROLLER, SteadyflowIndicatorControllerPrivate))
enum  {
	STEADYFLOW_INDICATOR_CONTROLLER_DUMMY_PROPERTY
};
#define STEADYFLOW_INDICATOR_CONTROLLER_MAX_FILE_MENU_ENTRIES 6
SteadyflowIndicatorController* steadyflow_indicator_controller_new (void);
SteadyflowIndicatorController* steadyflow_indicator_controller_construct (GType object_type);
void steadyflow_core_util_fatal_error (GError* e, const gchar* message);
GType steadyflow_ui_iindicator_service_get_type (void) G_GNUC_CONST;
SteadyflowUIIIndicatorService* steadyflow_services_get_indicator (void);
void steadyflow_ui_iindicator_service_set_menu (SteadyflowUIIIndicatorService* self, GtkMenu* menu);
GType steadyflow_core_isettings_service_get_type (void) G_GNUC_CONST;
SteadyflowCoreISettingsService* steadyflow_services_get_settings (void);
gboolean steadyflow_core_isettings_service_get_boolean (SteadyflowCoreISettingsService* self, const gchar* key);
void steadyflow_ui_iindicator_service_set_visible (SteadyflowUIIIndicatorService* self, gboolean value);
static void __lambda13_ (SteadyflowIndicatorController* self);
static void ___lambda13__steadyflow_core_isettings_service_changed (SteadyflowCoreISettingsService* _sender, gpointer self);
static void __lambda14_ (SteadyflowIndicatorController* self);
static void ___lambda14__gtk_toggle_action_toggled (GtkToggleAction* _sender, gpointer self);
static void __lambda15_ (SteadyflowIndicatorController* self);
void steadyflow_indicator_controller_set_main_window_visible (SteadyflowIndicatorController* self, gboolean visible);
static void ___lambda15__steadyflow_ui_iindicator_service_clicked (SteadyflowUIIIndicatorService* _sender, gpointer self);
static void __lambda16_ (SteadyflowIndicatorController* self);
static void ___lambda16__gtk_action_activate (GtkAction* _sender, gpointer self);
static void __lambda17_ (SteadyflowIndicatorController* self);
static void ___lambda17__gtk_action_activate (GtkAction* _sender, gpointer self);
static void steadyflow_indicator_controller_pause_all (SteadyflowIndicatorController* self);
static void _steadyflow_indicator_controller_pause_all_gtk_action_activate (GtkAction* _sender, gpointer self);
static void steadyflow_indicator_controller_resume_all (SteadyflowIndicatorController* self);
static void _steadyflow_indicator_controller_resume_all_gtk_action_activate (GtkAction* _sender, gpointer self);
GType steadyflow_core_idownload_file_status_get_type (void) G_GNUC_CONST;
GType steadyflow_core_idownload_file_finish_action_get_type (void) G_GNUC_CONST;
GType steadyflow_core_idownload_file_get_type (void) G_GNUC_CONST;
GType steadyflow_core_idownload_service_get_type (void) G_GNUC_CONST;
SteadyflowCoreIDownloadService* steadyflow_services_get_download (void);
GeeList* steadyflow_core_idownload_service_get_files (SteadyflowCoreIDownloadService* self);
static void steadyflow_indicator_controller_connect_file_signals (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFile* file);
static void __lambda21_ (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFile* file);
static void steadyflow_indicator_controller_update_file_menus (SteadyflowIndicatorController* self);
static void ___lambda21__steadyflow_core_idownload_service_file_added (SteadyflowCoreIDownloadService* _sender, SteadyflowCoreIDownloadFile* file, gpointer self);
static void __lambda22_ (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFile* file);
static void ___lambda22__steadyflow_core_idownload_service_file_removed (SteadyflowCoreIDownloadService* _sender, SteadyflowCoreIDownloadFile* file, gpointer self);
static void __lambda18_ (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFileStatus old_status);
static void ___lambda18__steadyflow_core_idownload_file_status_changed (SteadyflowCoreIDownloadFile* _sender, SteadyflowCoreIDownloadFileStatus old_status, gpointer self);
gboolean steadyflow_core_idownload_file_can_pause (SteadyflowCoreIDownloadFile* self);
gboolean steadyflow_core_idownload_file_can_start (SteadyflowCoreIDownloadFile* self);
static Block5Data* block5_data_ref (Block5Data* _data5_);
static void block5_data_unref (void * _userdata_);
gint steadyflow_core_idownload_file_get_uid (SteadyflowCoreIDownloadFile* self);
const gchar* steadyflow_core_idownload_file_get_local_basename (SteadyflowCoreIDownloadFile* self);
static void ______lambda19_ (Block5Data* _data5_);
void steadyflow_core_idownload_file_start (SteadyflowCoreIDownloadFile* self, gboolean resume);
static void _______lambda19__gtk_action_activate (GtkAction* _sender, gpointer self);
static void ______lambda20_ (Block5Data* _data5_);
void steadyflow_core_idownload_file_pause (SteadyflowCoreIDownloadFile* self);
static void _______lambda20__gtk_action_activate (GtkAction* _sender, gpointer self);
static void steadyflow_indicator_controller_finalize (GObject* obj);


static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


static void __lambda13_ (SteadyflowIndicatorController* self) {
	SteadyflowUIIIndicatorService* _tmp0_;
	SteadyflowUIIIndicatorService* _tmp1_;
	SteadyflowCoreISettingsService* _tmp2_;
	SteadyflowCoreISettingsService* _tmp3_;
	gboolean _tmp4_ = FALSE;
	_tmp0_ = steadyflow_services_get_indicator ();
	_tmp1_ = _tmp0_;
	_tmp2_ = steadyflow_services_get_settings ();
	_tmp3_ = _tmp2_;
	_tmp4_ = steadyflow_core_isettings_service_get_boolean (_tmp3_, "show-indicator");
	steadyflow_ui_iindicator_service_set_visible (_tmp1_, _tmp4_);
}


static void ___lambda13__steadyflow_core_isettings_service_changed (SteadyflowCoreISettingsService* _sender, gpointer self) {
	__lambda13_ (self);
}


static void __lambda14_ (SteadyflowIndicatorController* self) {
	GtkToggleAction* _tmp0_;
	gboolean _tmp1_;
	gboolean _tmp2_;
	_tmp0_ = self->priv->show_hide_action;
	_tmp1_ = gtk_toggle_action_get_active (_tmp0_);
	_tmp2_ = _tmp1_;
	g_signal_emit_by_name (self, "show-hide-toggled", _tmp2_);
}


static void ___lambda14__gtk_toggle_action_toggled (GtkToggleAction* _sender, gpointer self) {
	__lambda14_ (self);
}


static void __lambda15_ (SteadyflowIndicatorController* self) {
	GtkToggleAction* _tmp0_;
	gboolean _tmp1_;
	gboolean _tmp2_;
	_tmp0_ = self->priv->show_hide_action;
	_tmp1_ = gtk_toggle_action_get_active (_tmp0_);
	_tmp2_ = _tmp1_;
	steadyflow_indicator_controller_set_main_window_visible (self, !_tmp2_);
}


static void ___lambda15__steadyflow_ui_iindicator_service_clicked (SteadyflowUIIIndicatorService* _sender, gpointer self) {
	__lambda15_ (self);
}


static void __lambda16_ (SteadyflowIndicatorController* self) {
	g_signal_emit_by_name (self, "add-download-clicked");
}


static void ___lambda16__gtk_action_activate (GtkAction* _sender, gpointer self) {
	__lambda16_ (self);
}


static void __lambda17_ (SteadyflowIndicatorController* self) {
	g_signal_emit_by_name (self, "quit-clicked");
}


static void ___lambda17__gtk_action_activate (GtkAction* _sender, gpointer self) {
	__lambda17_ (self);
}


static void _steadyflow_indicator_controller_pause_all_gtk_action_activate (GtkAction* _sender, gpointer self) {
	steadyflow_indicator_controller_pause_all (self);
}


static void _steadyflow_indicator_controller_resume_all_gtk_action_activate (GtkAction* _sender, gpointer self) {
	steadyflow_indicator_controller_resume_all (self);
}


static void __lambda21_ (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFile* file) {
	SteadyflowCoreIDownloadFile* _tmp0_;
	g_return_if_fail (file != NULL);
	_tmp0_ = file;
	steadyflow_indicator_controller_connect_file_signals (self, _tmp0_);
	steadyflow_indicator_controller_update_file_menus (self);
}


static void ___lambda21__steadyflow_core_idownload_service_file_added (SteadyflowCoreIDownloadService* _sender, SteadyflowCoreIDownloadFile* file, gpointer self) {
	__lambda21_ (self, file);
}


static void __lambda22_ (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFile* file) {
	g_return_if_fail (file != NULL);
	steadyflow_indicator_controller_update_file_menus (self);
}


static void ___lambda22__steadyflow_core_idownload_service_file_removed (SteadyflowCoreIDownloadService* _sender, SteadyflowCoreIDownloadFile* file, gpointer self) {
	__lambda22_ (self, file);
}


SteadyflowIndicatorController* steadyflow_indicator_controller_construct (GType object_type) {
	SteadyflowIndicatorController * self = NULL;
	GtkUIManager* _tmp0_;
	GtkActionGroup* _tmp1_;
	GtkActionGroup* action_group;
	GtkActionEntry* _tmp2_;
	gint _tmp2__length1;
	GtkToggleActionEntry* _tmp3_;
	gint _tmp3__length1;
	GtkUIManager* _tmp4_;
	GtkUIManager* _tmp8_;
	GtkWidget* _tmp9_ = NULL;
	GtkMenu* _tmp10_;
	SteadyflowUIIIndicatorService* _tmp11_;
	SteadyflowUIIIndicatorService* _tmp12_;
	GtkMenu* _tmp13_;
	SteadyflowUIIIndicatorService* _tmp14_;
	SteadyflowUIIIndicatorService* _tmp15_;
	SteadyflowCoreISettingsService* _tmp16_;
	SteadyflowCoreISettingsService* _tmp17_;
	gboolean _tmp18_ = FALSE;
	SteadyflowCoreISettingsService* _tmp19_;
	SteadyflowCoreISettingsService* _tmp20_;
	GtkAction* _tmp21_ = NULL;
	GtkToggleAction* _tmp22_;
	GtkToggleAction* _tmp23_;
	SteadyflowCoreISettingsService* _tmp24_;
	SteadyflowCoreISettingsService* _tmp25_;
	gboolean _tmp26_ = FALSE;
	GtkToggleAction* _tmp27_;
	SteadyflowUIIIndicatorService* _tmp28_;
	SteadyflowUIIIndicatorService* _tmp29_;
	GtkAction* _tmp30_ = NULL;
	GtkAction* _tmp31_ = NULL;
	GtkAction* _tmp32_ = NULL;
	GtkAction* _tmp33_;
	GtkAction* _tmp34_;
	GtkAction* _tmp35_;
	GtkAction* _tmp36_ = NULL;
	GtkAction* _tmp37_;
	GtkAction* _tmp38_;
	GtkAction* _tmp39_;
	SteadyflowCoreIDownloadService* _tmp54_;
	SteadyflowCoreIDownloadService* _tmp55_;
	SteadyflowCoreIDownloadService* _tmp56_;
	SteadyflowCoreIDownloadService* _tmp57_;
	GError * _inner_error_ = NULL;
	self = (SteadyflowIndicatorController*) g_object_new (object_type, NULL);
	_tmp0_ = gtk_ui_manager_new ();
	_g_object_unref0 (self->priv->ui_manager);
	self->priv->ui_manager = _tmp0_;
	_tmp1_ = gtk_action_group_new ("main");
	action_group = _tmp1_;
	_tmp2_ = self->priv->actions;
	_tmp2__length1 = self->priv->actions_length1;
	gtk_action_group_add_actions (action_group, _tmp2_, _tmp2__length1, NULL);
	_tmp3_ = self->priv->toggle_actions;
	_tmp3__length1 = self->priv->toggle_actions_length1;
	gtk_action_group_add_toggle_actions (action_group, _tmp3_, _tmp3__length1, NULL);
	_tmp4_ = self->priv->ui_manager;
	gtk_ui_manager_insert_action_group (_tmp4_, action_group, 0);
	{
		GtkUIManager* _tmp5_;
		gint _tmp6_;
		gint _tmp7_;
		_tmp5_ = self->priv->ui_manager;
		_tmp6_ = strlen (STEADYFLOW_INDICATOR_MENU);
		_tmp7_ = _tmp6_;
		gtk_ui_manager_add_ui_from_string (_tmp5_, STEADYFLOW_INDICATOR_MENU, (gssize) _tmp7_, &_inner_error_);
		if (_inner_error_ != NULL) {
			goto __catch18_g_error;
		}
	}
	goto __finally18;
	__catch18_g_error:
	{
		GError* e = NULL;
		e = _inner_error_;
		_inner_error_ = NULL;
		steadyflow_core_util_fatal_error (e, NULL);
		_g_error_free0 (e);
	}
	__finally18:
	if (_inner_error_ != NULL) {
		_g_object_unref0 (action_group);
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
		g_clear_error (&_inner_error_);
		return NULL;
	}
	_tmp8_ = self->priv->ui_manager;
	_tmp9_ = gtk_ui_manager_get_widget (_tmp8_, "/ui/IndicatorMenu");
	_tmp10_ = _g_object_ref0 (GTK_MENU (_tmp9_));
	_g_object_unref0 (self->priv->menu);
	self->priv->menu = _tmp10_;
	_tmp11_ = steadyflow_services_get_indicator ();
	_tmp12_ = _tmp11_;
	_tmp13_ = self->priv->menu;
	steadyflow_ui_iindicator_service_set_menu (_tmp12_, _tmp13_);
	_tmp14_ = steadyflow_services_get_indicator ();
	_tmp15_ = _tmp14_;
	_tmp16_ = steadyflow_services_get_settings ();
	_tmp17_ = _tmp16_;
	_tmp18_ = steadyflow_core_isettings_service_get_boolean (_tmp17_, "show-indicator");
	steadyflow_ui_iindicator_service_set_visible (_tmp15_, _tmp18_);
	_tmp19_ = steadyflow_services_get_settings ();
	_tmp20_ = _tmp19_;
	g_signal_connect_object (_tmp20_, "changed::show-indicator", (GCallback) ___lambda13__steadyflow_core_isettings_service_changed, self, 0);
	_tmp21_ = gtk_action_group_get_action (action_group, "ShowHide");
	_tmp22_ = _g_object_ref0 (GTK_TOGGLE_ACTION (_tmp21_));
	_g_object_unref0 (self->priv->show_hide_action);
	self->priv->show_hide_action = _tmp22_;
	_tmp23_ = self->priv->show_hide_action;
	_tmp24_ = steadyflow_services_get_settings ();
	_tmp25_ = _tmp24_;
	_tmp26_ = steadyflow_core_isettings_service_get_boolean (_tmp25_, "start-minimized");
	gtk_toggle_action_set_active (_tmp23_, !_tmp26_);
	_tmp27_ = self->priv->show_hide_action;
	g_signal_connect_object (_tmp27_, "toggled", (GCallback) ___lambda14__gtk_toggle_action_toggled, self, 0);
	_tmp28_ = steadyflow_services_get_indicator ();
	_tmp29_ = _tmp28_;
	g_signal_connect_object (_tmp29_, "clicked", (GCallback) ___lambda15__steadyflow_ui_iindicator_service_clicked, self, 0);
	_tmp30_ = gtk_action_group_get_action (action_group, "Add");
	g_signal_connect_object (_tmp30_, "activate", (GCallback) ___lambda16__gtk_action_activate, self, 0);
	_tmp31_ = gtk_action_group_get_action (action_group, "Quit");
	g_signal_connect_object (_tmp31_, "activate", (GCallback) ___lambda17__gtk_action_activate, self, 0);
	_tmp32_ = gtk_action_group_get_action (action_group, "PauseAll");
	_tmp33_ = _g_object_ref0 (GTK_ACTION (_tmp32_));
	_g_object_unref0 (self->priv->pause_all_action);
	self->priv->pause_all_action = _tmp33_;
	_tmp34_ = self->priv->pause_all_action;
	gtk_action_set_sensitive (_tmp34_, FALSE);
	_tmp35_ = self->priv->pause_all_action;
	g_signal_connect_object (_tmp35_, "activate", (GCallback) _steadyflow_indicator_controller_pause_all_gtk_action_activate, self, 0);
	_tmp36_ = gtk_action_group_get_action (action_group, "ResumeAll");
	_tmp37_ = _g_object_ref0 (GTK_ACTION (_tmp36_));
	_g_object_unref0 (self->priv->resume_all_action);
	self->priv->resume_all_action = _tmp37_;
	_tmp38_ = self->priv->resume_all_action;
	gtk_action_set_sensitive (_tmp38_, FALSE);
	_tmp39_ = self->priv->resume_all_action;
	g_signal_connect_object (_tmp39_, "activate", (GCallback) _steadyflow_indicator_controller_resume_all_gtk_action_activate, self, 0);
	{
		SteadyflowCoreIDownloadService* _tmp40_;
		SteadyflowCoreIDownloadService* _tmp41_;
		GeeList* _tmp42_;
		GeeList* _tmp43_;
		GeeList* _file_list;
		GeeList* _tmp44_;
		gint _tmp45_;
		gint _tmp46_;
		gint _file_size;
		gint _file_index;
		_tmp40_ = steadyflow_services_get_download ();
		_tmp41_ = _tmp40_;
		_tmp42_ = steadyflow_core_idownload_service_get_files (_tmp41_);
		_tmp43_ = _tmp42_;
		_file_list = _tmp43_;
		_tmp44_ = _file_list;
		_tmp45_ = gee_collection_get_size ((GeeCollection*) _tmp44_);
		_tmp46_ = _tmp45_;
		_file_size = _tmp46_;
		_file_index = -1;
		while (TRUE) {
			gint _tmp47_;
			gint _tmp48_;
			gint _tmp49_;
			GeeList* _tmp50_;
			gint _tmp51_;
			gpointer _tmp52_ = NULL;
			SteadyflowCoreIDownloadFile* file;
			SteadyflowCoreIDownloadFile* _tmp53_;
			_tmp47_ = _file_index;
			_file_index = _tmp47_ + 1;
			_tmp48_ = _file_index;
			_tmp49_ = _file_size;
			if (!(_tmp48_ < _tmp49_)) {
				break;
			}
			_tmp50_ = _file_list;
			_tmp51_ = _file_index;
			_tmp52_ = gee_list_get (_tmp50_, _tmp51_);
			file = (SteadyflowCoreIDownloadFile*) _tmp52_;
			_tmp53_ = file;
			steadyflow_indicator_controller_connect_file_signals (self, _tmp53_);
			_g_object_unref0 (file);
		}
		_g_object_unref0 (_file_list);
	}
	_tmp54_ = steadyflow_services_get_download ();
	_tmp55_ = _tmp54_;
	g_signal_connect_object (_tmp55_, "file-added", (GCallback) ___lambda21__steadyflow_core_idownload_service_file_added, self, 0);
	_tmp56_ = steadyflow_services_get_download ();
	_tmp57_ = _tmp56_;
	g_signal_connect_object (_tmp57_, "file-removed", (GCallback) ___lambda22__steadyflow_core_idownload_service_file_removed, self, 0);
	steadyflow_indicator_controller_update_file_menus (self);
	_g_object_unref0 (action_group);
	return self;
}


SteadyflowIndicatorController* steadyflow_indicator_controller_new (void) {
	return steadyflow_indicator_controller_construct (STEADYFLOW_TYPE_INDICATOR_CONTROLLER);
}


void steadyflow_indicator_controller_set_main_window_visible (SteadyflowIndicatorController* self, gboolean visible) {
	GtkToggleAction* _tmp0_;
	gboolean _tmp1_;
	SteadyflowUIIIndicatorService* _tmp2_;
	SteadyflowUIIIndicatorService* _tmp3_;
	GtkMenu* _tmp4_;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->priv->show_hide_action;
	_tmp1_ = visible;
	gtk_toggle_action_set_active (_tmp0_, _tmp1_);
	_tmp2_ = steadyflow_services_get_indicator ();
	_tmp3_ = _tmp2_;
	_tmp4_ = self->priv->menu;
	steadyflow_ui_iindicator_service_set_menu (_tmp3_, _tmp4_);
}


static void __lambda18_ (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFileStatus old_status) {
	steadyflow_indicator_controller_update_file_menus (self);
}


static void ___lambda18__steadyflow_core_idownload_file_status_changed (SteadyflowCoreIDownloadFile* _sender, SteadyflowCoreIDownloadFileStatus old_status, gpointer self) {
	__lambda18_ (self, old_status);
}


static void steadyflow_indicator_controller_connect_file_signals (SteadyflowIndicatorController* self, SteadyflowCoreIDownloadFile* file) {
	SteadyflowCoreIDownloadFile* _tmp0_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (file != NULL);
	_tmp0_ = file;
	g_signal_connect_object (_tmp0_, "status-changed", (GCallback) ___lambda18__steadyflow_core_idownload_file_status_changed, self, 0);
}


static Block5Data* block5_data_ref (Block5Data* _data5_) {
	g_atomic_int_inc (&_data5_->_ref_count_);
	return _data5_;
}


static void block5_data_unref (void * _userdata_) {
	Block5Data* _data5_;
	_data5_ = (Block5Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data5_->_ref_count_)) {
		SteadyflowIndicatorController * self;
		self = _data5_->self;
		_g_object_unref0 (_data5_->file);
		_g_object_unref0 (self);
		g_slice_free (Block5Data, _data5_);
	}
}


static gchar* string_replace (const gchar* self, const gchar* old, const gchar* replacement) {
	gchar* result = NULL;
	GError * _inner_error_ = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (old != NULL, NULL);
	g_return_val_if_fail (replacement != NULL, NULL);
	{
		const gchar* _tmp0_;
		gchar* _tmp1_ = NULL;
		gchar* _tmp2_;
		GRegex* _tmp3_;
		GRegex* _tmp4_;
		GRegex* regex;
		GRegex* _tmp5_;
		const gchar* _tmp6_;
		gchar* _tmp7_ = NULL;
		gchar* _tmp8_;
		_tmp0_ = old;
		_tmp1_ = g_regex_escape_string (_tmp0_, -1);
		_tmp2_ = _tmp1_;
		_tmp3_ = g_regex_new (_tmp2_, 0, 0, &_inner_error_);
		_tmp4_ = _tmp3_;
		_g_free0 (_tmp2_);
		regex = _tmp4_;
		if (_inner_error_ != NULL) {
			if (_inner_error_->domain == G_REGEX_ERROR) {
				goto __catch19_g_regex_error;
			}
			g_critical ("file %s: line %d: unexpected error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
			g_clear_error (&_inner_error_);
			return NULL;
		}
		_tmp5_ = regex;
		_tmp6_ = replacement;
		_tmp7_ = g_regex_replace_literal (_tmp5_, self, (gssize) (-1), 0, _tmp6_, 0, &_inner_error_);
		_tmp8_ = _tmp7_;
		if (_inner_error_ != NULL) {
			_g_regex_unref0 (regex);
			if (_inner_error_->domain == G_REGEX_ERROR) {
				goto __catch19_g_regex_error;
			}
			_g_regex_unref0 (regex);
			g_critical ("file %s: line %d: unexpected error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
			g_clear_error (&_inner_error_);
			return NULL;
		}
		result = _tmp8_;
		_g_regex_unref0 (regex);
		return result;
	}
	goto __finally19;
	__catch19_g_regex_error:
	{
		GError* e = NULL;
		e = _inner_error_;
		_inner_error_ = NULL;
		g_assert_not_reached ();
		_g_error_free0 (e);
	}
	__finally19:
	if (_inner_error_ != NULL) {
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
		g_clear_error (&_inner_error_);
		return NULL;
	}
}


static void ______lambda19_ (Block5Data* _data5_) {
	SteadyflowIndicatorController * self;
	SteadyflowCoreIDownloadFile* _tmp0_;
	self = _data5_->self;
	_tmp0_ = _data5_->file;
	steadyflow_core_idownload_file_start (_tmp0_, TRUE);
}


static void _______lambda19__gtk_action_activate (GtkAction* _sender, gpointer self) {
	______lambda19_ (self);
}


static void ______lambda20_ (Block5Data* _data5_) {
	SteadyflowIndicatorController * self;
	SteadyflowCoreIDownloadFile* _tmp0_;
	self = _data5_->self;
	_tmp0_ = _data5_->file;
	steadyflow_core_idownload_file_pause (_tmp0_);
}


static void _______lambda20__gtk_action_activate (GtkAction* _sender, gpointer self) {
	______lambda20_ (self);
}


static void steadyflow_indicator_controller_update_file_menus (SteadyflowIndicatorController* self) {
	gboolean enable_pause_all;
	gboolean enable_resume_all;
	GeeArrayList* _tmp0_;
	GeeArrayList* files_for_menu;
	GtkAction* _tmp31_;
	gboolean _tmp32_;
	GtkAction* _tmp33_;
	gboolean _tmp34_;
	GtkActionGroup* _tmp35_;
	guint _tmp38_;
	GeeArrayList* _tmp41_;
	gint _tmp42_;
	gint _tmp43_;
	SteadyflowUIIIndicatorService* _tmp102_;
	SteadyflowUIIIndicatorService* _tmp103_;
	GtkMenu* _tmp104_;
	GError * _inner_error_ = NULL;
	g_return_if_fail (self != NULL);
	enable_pause_all = FALSE;
	enable_resume_all = FALSE;
	_tmp0_ = gee_array_list_new (STEADYFLOW_CORE_TYPE_IDOWNLOAD_FILE, (GBoxedCopyFunc) g_object_ref, g_object_unref, NULL);
	files_for_menu = _tmp0_;
	{
		SteadyflowCoreIDownloadService* _tmp1_;
		SteadyflowCoreIDownloadService* _tmp2_;
		GeeList* _tmp3_;
		GeeList* _tmp4_;
		GeeList* _file_list;
		GeeList* _tmp5_;
		gint _tmp6_;
		gint _tmp7_;
		gint _file_size;
		gint _file_index;
		_tmp1_ = steadyflow_services_get_download ();
		_tmp2_ = _tmp1_;
		_tmp3_ = steadyflow_core_idownload_service_get_files (_tmp2_);
		_tmp4_ = _tmp3_;
		_file_list = _tmp4_;
		_tmp5_ = _file_list;
		_tmp6_ = gee_collection_get_size ((GeeCollection*) _tmp5_);
		_tmp7_ = _tmp6_;
		_file_size = _tmp7_;
		_file_index = -1;
		while (TRUE) {
			gint _tmp8_;
			gint _tmp9_;
			gint _tmp10_;
			GeeList* _tmp11_;
			gint _tmp12_;
			gpointer _tmp13_ = NULL;
			SteadyflowCoreIDownloadFile* file;
			SteadyflowCoreIDownloadFile* _tmp14_;
			gboolean _tmp15_ = FALSE;
			SteadyflowCoreIDownloadFile* _tmp16_;
			gboolean _tmp17_ = FALSE;
			gboolean _tmp18_ = FALSE;
			GeeArrayList* _tmp19_;
			gint _tmp20_;
			gint _tmp21_;
			gboolean _tmp28_;
			_tmp8_ = _file_index;
			_file_index = _tmp8_ + 1;
			_tmp9_ = _file_index;
			_tmp10_ = _file_size;
			if (!(_tmp9_ < _tmp10_)) {
				break;
			}
			_tmp11_ = _file_list;
			_tmp12_ = _file_index;
			_tmp13_ = gee_list_get (_tmp11_, _tmp12_);
			file = (SteadyflowCoreIDownloadFile*) _tmp13_;
			_tmp14_ = file;
			_tmp15_ = steadyflow_core_idownload_file_can_pause (_tmp14_);
			if (_tmp15_) {
				enable_pause_all = TRUE;
			}
			_tmp16_ = file;
			_tmp17_ = steadyflow_core_idownload_file_can_start (_tmp16_);
			if (_tmp17_) {
				enable_resume_all = TRUE;
			}
			_tmp19_ = files_for_menu;
			_tmp20_ = gee_abstract_collection_get_size ((GeeCollection*) _tmp19_);
			_tmp21_ = _tmp20_;
			if (_tmp21_ < STEADYFLOW_INDICATOR_CONTROLLER_MAX_FILE_MENU_ENTRIES) {
				gboolean _tmp22_ = FALSE;
				SteadyflowCoreIDownloadFile* _tmp23_;
				gboolean _tmp24_ = FALSE;
				gboolean _tmp27_;
				_tmp23_ = file;
				_tmp24_ = steadyflow_core_idownload_file_can_start (_tmp23_);
				if (_tmp24_) {
					_tmp22_ = TRUE;
				} else {
					SteadyflowCoreIDownloadFile* _tmp25_;
					gboolean _tmp26_ = FALSE;
					_tmp25_ = file;
					_tmp26_ = steadyflow_core_idownload_file_can_pause (_tmp25_);
					_tmp22_ = _tmp26_;
				}
				_tmp27_ = _tmp22_;
				_tmp18_ = _tmp27_;
			} else {
				_tmp18_ = FALSE;
			}
			_tmp28_ = _tmp18_;
			if (_tmp28_) {
				GeeArrayList* _tmp29_;
				SteadyflowCoreIDownloadFile* _tmp30_;
				_tmp29_ = files_for_menu;
				_tmp30_ = file;
				gee_abstract_collection_add ((GeeAbstractCollection*) _tmp29_, _tmp30_);
			}
			_g_object_unref0 (file);
		}
		_g_object_unref0 (_file_list);
	}
	_tmp31_ = self->priv->pause_all_action;
	_tmp32_ = enable_pause_all;
	gtk_action_set_sensitive (_tmp31_, _tmp32_);
	_tmp33_ = self->priv->resume_all_action;
	_tmp34_ = enable_resume_all;
	gtk_action_set_sensitive (_tmp33_, _tmp34_);
	_tmp35_ = self->priv->merged_action_group;
	if (_tmp35_ != NULL) {
		GtkUIManager* _tmp36_;
		GtkActionGroup* _tmp37_;
		_tmp36_ = self->priv->ui_manager;
		_tmp37_ = self->priv->merged_action_group;
		gtk_ui_manager_remove_action_group (_tmp36_, _tmp37_);
	}
	_tmp38_ = self->priv->merge_id;
	if (_tmp38_ != ((guint) 0)) {
		GtkUIManager* _tmp39_;
		guint _tmp40_;
		_tmp39_ = self->priv->ui_manager;
		_tmp40_ = self->priv->merge_id;
		gtk_ui_manager_remove_ui (_tmp39_, _tmp40_);
	}
	_tmp41_ = files_for_menu;
	_tmp42_ = gee_abstract_collection_get_size ((GeeCollection*) _tmp41_);
	_tmp43_ = _tmp42_;
	if (_tmp43_ == 0) {
		_g_object_unref0 (self->priv->merged_action_group);
		self->priv->merged_action_group = NULL;
		self->priv->merge_id = (guint) 0;
	} else {
		GtkActionGroup* _tmp44_;
		GString* _tmp45_;
		GString* new_items;
		GString* _tmp89_;
		const gchar* _tmp90_;
		gchar* _tmp91_ = NULL;
		gchar* new_ui;
		GtkUIManager* _tmp99_;
		GtkActionGroup* _tmp100_;
		GtkUIManager* _tmp101_;
		_tmp44_ = gtk_action_group_new ("fileitems");
		_g_object_unref0 (self->priv->merged_action_group);
		self->priv->merged_action_group = _tmp44_;
		_tmp45_ = g_string_new ("");
		new_items = _tmp45_;
		{
			GeeArrayList* _tmp46_;
			GeeArrayList* _tmp47_;
			GeeArrayList* _file_list;
			GeeArrayList* _tmp48_;
			gint _tmp49_;
			gint _tmp50_;
			gint _file_size;
			gint _file_index;
			_tmp46_ = files_for_menu;
			_tmp47_ = _g_object_ref0 (_tmp46_);
			_file_list = _tmp47_;
			_tmp48_ = _file_list;
			_tmp49_ = gee_abstract_collection_get_size ((GeeCollection*) _tmp48_);
			_tmp50_ = _tmp49_;
			_file_size = _tmp50_;
			_file_index = -1;
			while (TRUE) {
				Block5Data* _data5_;
				gint _tmp51_;
				gint _tmp52_;
				gint _tmp53_;
				GeeArrayList* _tmp54_;
				gint _tmp55_;
				gpointer _tmp56_ = NULL;
				SteadyflowCoreIDownloadFile* _tmp57_;
				gint _tmp58_;
				gint _tmp59_;
				gchar* _tmp60_ = NULL;
				gchar* action_name;
				SteadyflowCoreIDownloadFile* _tmp61_;
				const gchar* _tmp62_;
				const gchar* _tmp63_;
				gchar* _tmp64_ = NULL;
				gchar* file_label;
				GString* _tmp65_;
				const gchar* _tmp66_;
				gchar* _tmp67_ = NULL;
				gchar* _tmp68_;
				GtkAction* action = NULL;
				SteadyflowCoreIDownloadFile* _tmp69_;
				gboolean _tmp70_ = FALSE;
				GtkActionGroup* _tmp87_;
				GtkAction* _tmp88_;
				_data5_ = g_slice_new0 (Block5Data);
				_data5_->_ref_count_ = 1;
				_data5_->self = g_object_ref (self);
				_tmp51_ = _file_index;
				_file_index = _tmp51_ + 1;
				_tmp52_ = _file_index;
				_tmp53_ = _file_size;
				if (!(_tmp52_ < _tmp53_)) {
					block5_data_unref (_data5_);
					_data5_ = NULL;
					break;
				}
				_tmp54_ = _file_list;
				_tmp55_ = _file_index;
				_tmp56_ = gee_abstract_list_get ((GeeAbstractList*) _tmp54_, _tmp55_);
				_data5_->file = (SteadyflowCoreIDownloadFile*) _tmp56_;
				_tmp57_ = _data5_->file;
				_tmp58_ = steadyflow_core_idownload_file_get_uid (_tmp57_);
				_tmp59_ = _tmp58_;
				_tmp60_ = g_strdup_printf ("FileAction%d", _tmp59_);
				action_name = _tmp60_;
				_tmp61_ = _data5_->file;
				_tmp62_ = steadyflow_core_idownload_file_get_local_basename (_tmp61_);
				_tmp63_ = _tmp62_;
				_tmp64_ = string_replace (_tmp63_, "_", "__");
				file_label = _tmp64_;
				_tmp65_ = new_items;
				_tmp66_ = action_name;
				_tmp67_ = g_strdup_printf ("<menuitem action='%s' />", _tmp66_);
				_tmp68_ = _tmp67_;
				g_string_append (_tmp65_, _tmp68_);
				_g_free0 (_tmp68_);
				_tmp69_ = _data5_->file;
				_tmp70_ = steadyflow_core_idownload_file_can_start (_tmp69_);
				if (_tmp70_) {
					const gchar* _tmp71_;
					const gchar* _tmp72_ = NULL;
					const gchar* _tmp73_;
					gchar* _tmp74_ = NULL;
					gchar* _tmp75_;
					GtkAction* _tmp76_;
					GtkAction* _tmp77_;
					GtkAction* _tmp78_;
					_tmp71_ = action_name;
					_tmp72_ = _ ("Start %s");
					_tmp73_ = file_label;
					_tmp74_ = g_strdup_printf (_tmp72_, _tmp73_);
					_tmp75_ = _tmp74_;
					_tmp76_ = gtk_action_new (_tmp71_, _tmp75_, NULL, NULL);
					_g_object_unref0 (action);
					action = _tmp76_;
					_g_free0 (_tmp75_);
					_tmp77_ = action;
					gtk_action_set_icon_name (_tmp77_, "media-playback-start");
					_tmp78_ = action;
					g_signal_connect_data (_tmp78_, "activate", (GCallback) _______lambda19__gtk_action_activate, block5_data_ref (_data5_), (GClosureNotify) block5_data_unref, 0);
				} else {
					const gchar* _tmp79_;
					const gchar* _tmp80_ = NULL;
					const gchar* _tmp81_;
					gchar* _tmp82_ = NULL;
					gchar* _tmp83_;
					GtkAction* _tmp84_;
					GtkAction* _tmp85_;
					GtkAction* _tmp86_;
					_tmp79_ = action_name;
					_tmp80_ = _ ("Pause %s");
					_tmp81_ = file_label;
					_tmp82_ = g_strdup_printf (_tmp80_, _tmp81_);
					_tmp83_ = _tmp82_;
					_tmp84_ = gtk_action_new (_tmp79_, _tmp83_, NULL, NULL);
					_g_object_unref0 (action);
					action = _tmp84_;
					_g_free0 (_tmp83_);
					_tmp85_ = action;
					gtk_action_set_icon_name (_tmp85_, "media-playback-pause");
					_tmp86_ = action;
					g_signal_connect_data (_tmp86_, "activate", (GCallback) _______lambda20__gtk_action_activate, block5_data_ref (_data5_), (GClosureNotify) block5_data_unref, 0);
				}
				_tmp87_ = self->priv->merged_action_group;
				_tmp88_ = action;
				gtk_action_group_add_action (_tmp87_, _tmp88_);
				_g_object_unref0 (action);
				_g_free0 (file_label);
				_g_free0 (action_name);
				block5_data_unref (_data5_);
				_data5_ = NULL;
			}
			_g_object_unref0 (_file_list);
		}
		_tmp89_ = new_items;
		_tmp90_ = _tmp89_->str;
		_tmp91_ = g_strdup_printf (STEADYFLOW_INSERT_TEMPLATE, _tmp90_);
		new_ui = _tmp91_;
		{
			GtkUIManager* _tmp92_;
			const gchar* _tmp93_;
			const gchar* _tmp94_;
			gint _tmp95_;
			gint _tmp96_;
			guint _tmp97_ = 0U;
			guint _tmp98_;
			_tmp92_ = self->priv->ui_manager;
			_tmp93_ = new_ui;
			_tmp94_ = new_ui;
			_tmp95_ = strlen (_tmp94_);
			_tmp96_ = _tmp95_;
			_tmp97_ = gtk_ui_manager_add_ui_from_string (_tmp92_, _tmp93_, (gssize) _tmp96_, &_inner_error_);
			_tmp98_ = _tmp97_;
			if (_inner_error_ != NULL) {
				goto __catch20_g_error;
			}
			self->priv->merge_id = _tmp98_;
		}
		goto __finally20;
		__catch20_g_error:
		{
			GError* e = NULL;
			e = _inner_error_;
			_inner_error_ = NULL;
			steadyflow_core_util_fatal_error (e, NULL);
			_g_error_free0 (e);
		}
		__finally20:
		if (_inner_error_ != NULL) {
			_g_free0 (new_ui);
			_g_string_free0 (new_items);
			_g_object_unref0 (files_for_menu);
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
			g_clear_error (&_inner_error_);
			return;
		}
		_tmp99_ = self->priv->ui_manager;
		_tmp100_ = self->priv->merged_action_group;
		gtk_ui_manager_insert_action_group (_tmp99_, _tmp100_, 1);
		_tmp101_ = self->priv->ui_manager;
		gtk_ui_manager_ensure_update (_tmp101_);
		_g_free0 (new_ui);
		_g_string_free0 (new_items);
	}
	_tmp102_ = steadyflow_services_get_indicator ();
	_tmp103_ = _tmp102_;
	_tmp104_ = self->priv->menu;
	steadyflow_ui_iindicator_service_set_menu (_tmp103_, _tmp104_);
	_g_object_unref0 (files_for_menu);
}


static void steadyflow_indicator_controller_pause_all (SteadyflowIndicatorController* self) {
	g_return_if_fail (self != NULL);
	{
		SteadyflowCoreIDownloadService* _tmp0_;
		SteadyflowCoreIDownloadService* _tmp1_;
		GeeList* _tmp2_;
		GeeList* _tmp3_;
		GeeList* _file_list;
		GeeList* _tmp4_;
		gint _tmp5_;
		gint _tmp6_;
		gint _file_size;
		gint _file_index;
		_tmp0_ = steadyflow_services_get_download ();
		_tmp1_ = _tmp0_;
		_tmp2_ = steadyflow_core_idownload_service_get_files (_tmp1_);
		_tmp3_ = _tmp2_;
		_file_list = _tmp3_;
		_tmp4_ = _file_list;
		_tmp5_ = gee_collection_get_size ((GeeCollection*) _tmp4_);
		_tmp6_ = _tmp5_;
		_file_size = _tmp6_;
		_file_index = -1;
		while (TRUE) {
			gint _tmp7_;
			gint _tmp8_;
			gint _tmp9_;
			GeeList* _tmp10_;
			gint _tmp11_;
			gpointer _tmp12_ = NULL;
			SteadyflowCoreIDownloadFile* file;
			SteadyflowCoreIDownloadFile* _tmp13_;
			gboolean _tmp14_ = FALSE;
			_tmp7_ = _file_index;
			_file_index = _tmp7_ + 1;
			_tmp8_ = _file_index;
			_tmp9_ = _file_size;
			if (!(_tmp8_ < _tmp9_)) {
				break;
			}
			_tmp10_ = _file_list;
			_tmp11_ = _file_index;
			_tmp12_ = gee_list_get (_tmp10_, _tmp11_);
			file = (SteadyflowCoreIDownloadFile*) _tmp12_;
			_tmp13_ = file;
			_tmp14_ = steadyflow_core_idownload_file_can_pause (_tmp13_);
			if (_tmp14_) {
				SteadyflowCoreIDownloadFile* _tmp15_;
				_tmp15_ = file;
				steadyflow_core_idownload_file_pause (_tmp15_);
			}
			_g_object_unref0 (file);
		}
		_g_object_unref0 (_file_list);
	}
}


static void steadyflow_indicator_controller_resume_all (SteadyflowIndicatorController* self) {
	g_return_if_fail (self != NULL);
	{
		SteadyflowCoreIDownloadService* _tmp0_;
		SteadyflowCoreIDownloadService* _tmp1_;
		GeeList* _tmp2_;
		GeeList* _tmp3_;
		GeeList* _file_list;
		GeeList* _tmp4_;
		gint _tmp5_;
		gint _tmp6_;
		gint _file_size;
		gint _file_index;
		_tmp0_ = steadyflow_services_get_download ();
		_tmp1_ = _tmp0_;
		_tmp2_ = steadyflow_core_idownload_service_get_files (_tmp1_);
		_tmp3_ = _tmp2_;
		_file_list = _tmp3_;
		_tmp4_ = _file_list;
		_tmp5_ = gee_collection_get_size ((GeeCollection*) _tmp4_);
		_tmp6_ = _tmp5_;
		_file_size = _tmp6_;
		_file_index = -1;
		while (TRUE) {
			gint _tmp7_;
			gint _tmp8_;
			gint _tmp9_;
			GeeList* _tmp10_;
			gint _tmp11_;
			gpointer _tmp12_ = NULL;
			SteadyflowCoreIDownloadFile* file;
			SteadyflowCoreIDownloadFile* _tmp13_;
			gboolean _tmp14_ = FALSE;
			_tmp7_ = _file_index;
			_file_index = _tmp7_ + 1;
			_tmp8_ = _file_index;
			_tmp9_ = _file_size;
			if (!(_tmp8_ < _tmp9_)) {
				break;
			}
			_tmp10_ = _file_list;
			_tmp11_ = _file_index;
			_tmp12_ = gee_list_get (_tmp10_, _tmp11_);
			file = (SteadyflowCoreIDownloadFile*) _tmp12_;
			_tmp13_ = file;
			_tmp14_ = steadyflow_core_idownload_file_can_start (_tmp13_);
			if (_tmp14_) {
				SteadyflowCoreIDownloadFile* _tmp15_;
				_tmp15_ = file;
				steadyflow_core_idownload_file_start (_tmp15_, TRUE);
			}
			_g_object_unref0 (file);
		}
		_g_object_unref0 (_file_list);
	}
}


static void steadyflow_indicator_controller_class_init (SteadyflowIndicatorControllerClass * klass) {
	GtkStockItem item = {0};
	GtkStockItem _tmp0_ = {0};
	GtkStockItem _tmp1_;
	const gchar* _tmp2_;
	gchar* _tmp3_;
	steadyflow_indicator_controller_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (SteadyflowIndicatorControllerPrivate));
	G_OBJECT_CLASS (klass)->finalize = steadyflow_indicator_controller_finalize;
	g_signal_new ("show_hide_toggled", STEADYFLOW_TYPE_INDICATOR_CONTROLLER, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__BOOLEAN, G_TYPE_NONE, 1, G_TYPE_BOOLEAN);
	g_signal_new ("add_download_clicked", STEADYFLOW_TYPE_INDICATOR_CONTROLLER, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
	g_signal_new ("quit_clicked", STEADYFLOW_TYPE_INDICATOR_CONTROLLER, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
	gtk_stock_lookup (GTK_STOCK_QUIT, &_tmp0_);
	item = _tmp0_;
	_tmp1_ = item;
	_tmp2_ = _tmp1_.label;
	_tmp3_ = g_strdup (_tmp2_);
	_g_free0 (steadyflow_indicator_controller_stock_quit_label);
	steadyflow_indicator_controller_stock_quit_label = _tmp3_;
}


static void steadyflow_indicator_controller_instance_init (SteadyflowIndicatorController * self) {
	const gchar* _tmp0_ = NULL;
	GtkActionEntry _tmp1_ = {0};
	const gchar* _tmp2_;
	GtkActionEntry _tmp3_ = {0};
	const gchar* _tmp4_ = NULL;
	GtkActionEntry _tmp5_ = {0};
	const gchar* _tmp6_ = NULL;
	GtkActionEntry _tmp7_ = {0};
	GtkActionEntry* _tmp8_ = NULL;
	const gchar* _tmp9_ = NULL;
	GtkToggleActionEntry _tmp10_ = {0};
	GtkToggleActionEntry* _tmp11_ = NULL;
	self->priv = STEADYFLOW_INDICATOR_CONTROLLER_GET_PRIVATE (self);
	_tmp0_ = _ ("_Add download...");
	memset (&_tmp1_, 0, sizeof (GtkActionEntry));
	_tmp1_.name = "Add";
	_tmp1_.stock_id = "list-add";
	_tmp1_.label = _tmp0_;
	_tmp2_ = steadyflow_indicator_controller_stock_quit_label;
	memset (&_tmp3_, 0, sizeof (GtkActionEntry));
	_tmp3_.name = "Quit";
	_tmp3_.stock_id = "system-shutdown";
	_tmp3_.label = _tmp2_;
	_tmp4_ = _ ("_Pause all");
	memset (&_tmp5_, 0, sizeof (GtkActionEntry));
	_tmp5_.name = "PauseAll";
	_tmp5_.stock_id = "media-playback-pause";
	_tmp5_.label = _tmp4_;
	_tmp6_ = _ ("_Resume all");
	memset (&_tmp7_, 0, sizeof (GtkActionEntry));
	_tmp7_.name = "ResumeAll";
	_tmp7_.stock_id = "media-playback-start";
	_tmp7_.label = _tmp6_;
	_tmp8_ = g_new0 (GtkActionEntry, 4);
	_tmp8_[0] = _tmp1_;
	_tmp8_[1] = _tmp3_;
	_tmp8_[2] = _tmp5_;
	_tmp8_[3] = _tmp7_;
	self->priv->actions = _tmp8_;
	self->priv->actions_length1 = 4;
	self->priv->_actions_size_ = self->priv->actions_length1;
	_tmp9_ = _ ("Show download manager");
	memset (&_tmp10_, 0, sizeof (GtkToggleActionEntry));
	_tmp10_.name = "ShowHide";
	_tmp10_.label = _tmp9_;
	_tmp11_ = g_new0 (GtkToggleActionEntry, 1);
	_tmp11_[0] = _tmp10_;
	self->priv->toggle_actions = _tmp11_;
	self->priv->toggle_actions_length1 = 1;
	self->priv->_toggle_actions_size_ = self->priv->toggle_actions_length1;
	self->priv->merged_action_group = NULL;
	self->priv->merge_id = (guint) 0;
}


static void steadyflow_indicator_controller_finalize (GObject* obj) {
	SteadyflowIndicatorController * self;
	self = STEADYFLOW_INDICATOR_CONTROLLER (obj);
	self->priv->actions = (g_free (self->priv->actions), NULL);
	self->priv->toggle_actions = (g_free (self->priv->toggle_actions), NULL);
	_g_object_unref0 (self->priv->ui_manager);
	_g_object_unref0 (self->priv->menu);
	_g_object_unref0 (self->priv->show_hide_action);
	_g_object_unref0 (self->priv->pause_all_action);
	_g_object_unref0 (self->priv->resume_all_action);
	_g_object_unref0 (self->priv->merged_action_group);
	G_OBJECT_CLASS (steadyflow_indicator_controller_parent_class)->finalize (obj);
}


GType steadyflow_indicator_controller_get_type (void) {
	static volatile gsize steadyflow_indicator_controller_type_id__volatile = 0;
	if (g_once_init_enter (&steadyflow_indicator_controller_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (SteadyflowIndicatorControllerClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) steadyflow_indicator_controller_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (SteadyflowIndicatorController), 0, (GInstanceInitFunc) steadyflow_indicator_controller_instance_init, NULL };
		GType steadyflow_indicator_controller_type_id;
		steadyflow_indicator_controller_type_id = g_type_register_static (G_TYPE_OBJECT, "SteadyflowIndicatorController", &g_define_type_info, 0);
		g_once_init_leave (&steadyflow_indicator_controller_type_id__volatile, steadyflow_indicator_controller_type_id);
	}
	return steadyflow_indicator_controller_type_id__volatile;
}



